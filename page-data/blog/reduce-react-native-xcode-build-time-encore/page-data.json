{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blog/reduce-react-native-xcode-build-time-encore/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://zanechua.com"}},"posts":{"html":"<p>The first post about reducing build times for xcode was written at <a href=\"/blog/reduce-react-native-xcode-build-time\">Reduce React Native XCode build time</a>.</p>\n<p>Since then, the author who made <code class=\"language-text\">xcode-archive-cache</code> has updated the tool and added support for XCFrameworks.</p>\n<p>This allows it to work with <code class=\"language-text\">react-native</code> and any XCode project that uses CocoaPods.</p>\n<h1 id=\"Journey\" style=\"position:relative;\">Journey<a href=\"#Journey\" aria-label=\"Journey permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>I initially tried this tool but was facing issues when compiling the project. I opened an <a href=\"https://github.com/sweatco/xcode-archive-cache/issues/28\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">issue</a> on GitHub with the relevant information to see if it could be fixed.</p>\n<p>The author came back smashing with an <a href=\"https://github.com/sweatco/xcode-archive-cache/pull/29\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">update</a> that allowed exactly that to happen.</p>\n<p>As compared with <a href=\"https://github.com/mbitsnbites/buildcache\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><strong>buildcache</strong></a>, <a href=\"https://github.com/sweatco/xcode-archive-cache\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><strong>xcode-archive-cache</strong></a> works even better.</p>\n<p>Here are the timings I was getting with the <a href=\"https://kopirun.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">KopiRun</a> project on the M1 Macbook Pro.</p>\n<ul>\n<li>Clean Project: 10minutes</li>\n<li>buildcache: 7 minutes</li>\n<li>xcode-archive-cache: 5 minutes</li>\n</ul>\n<h1 id=\"Solve\" style=\"position:relative;\">Solve<a href=\"#Solve\" aria-label=\"Solve permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>Create a file called <code class=\"language-text\">Cachefile</code> in the <code class=\"language-text\">ios</code> folder of your project.</p>\n<p>Here's a sample that uses a Notification Service Extension with XCode Schemes.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">Cachefile</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"20483412122387223000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`workspace &quot;kopirun&quot; do\n  configuration &quot;release&quot; do\n    build_configuration &quot;Release&quot;\n  end\n\n  configuration &quot;dev&quot; do\n    build_configuration &quot;Dev.Release&quot;\n  end\n\n  derived_data_path &quot;build&quot;\n\n  target &quot;kopirun&quot; do\n    cache &quot;libPods-kopirun.a&quot;\n  end\n\n  target &quot;notification-service-extension&quot; do\n    cache &quot;libPods-notification-service-extension.a&quot;\n  end\nend`, `20483412122387223000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\">workspace <span class=\"token string-literal\"><span class=\"token string\">\"kopirun\"</span></span> <span class=\"token keyword\">do</span>\n  configuration <span class=\"token string-literal\"><span class=\"token string\">\"release\"</span></span> <span class=\"token keyword\">do</span>\n    build_configuration <span class=\"token string-literal\"><span class=\"token string\">\"Release\"</span></span>\n  <span class=\"token keyword\">end</span>\n\n  configuration <span class=\"token string-literal\"><span class=\"token string\">\"dev\"</span></span> <span class=\"token keyword\">do</span>\n    build_configuration <span class=\"token string-literal\"><span class=\"token string\">\"Dev.Release\"</span></span>\n  <span class=\"token keyword\">end</span>\n\n  derived_data_path <span class=\"token string-literal\"><span class=\"token string\">\"build\"</span></span>\n\n  target <span class=\"token string-literal\"><span class=\"token string\">\"kopirun\"</span></span> <span class=\"token keyword\">do</span>\n    cache <span class=\"token string-literal\"><span class=\"token string\">\"libPods-kopirun.a\"</span></span>\n  <span class=\"token keyword\">end</span>\n\n  target <span class=\"token string-literal\"><span class=\"token string\">\"notification-service-extension\"</span></span> <span class=\"token keyword\">do</span>\n    cache <span class=\"token string-literal\"><span class=\"token string\">\"libPods-notification-service-extension.a\"</span></span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Create a file called <code class=\"language-text\">Gemfile</code> in the <code class=\"language-text\">ios</code> folder of your project.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">Gemfile</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"86813562493659460000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`# Gemfile\nsource &quot;https://rubygems.org&quot;\n\ngem &quot;cocoapods&quot;, &quot;1.10.1&quot;\ngem &quot;xcode-archive-cache&quot;, &quot;0.0.11&quot;`, `86813562493659460000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token comment\"># Gemfile</span>\nsource <span class=\"token string-literal\"><span class=\"token string\">\"https://rubygems.org\"</span></span>\n\ngem <span class=\"token string-literal\"><span class=\"token string\">\"cocoapods\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token string-literal\"><span class=\"token string\">\"1.10.1\"</span></span>\ngem <span class=\"token string-literal\"><span class=\"token string\">\"xcode-archive-cache\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token string-literal\"><span class=\"token string\">\"0.0.11\"</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Run the following commands to set it up in your project.</p>\n<ol>\n<li>Change to the <code class=\"language-text\">ios</code> directory</li>\n<li>Install <code class=\"language-text\">cocoapods</code> and <code class=\"language-text\">xcode-archive-cache</code> based on the <code class=\"language-text\">Gemfile</code></li>\n<li>Install Pods for the iOS project</li>\n</ol>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">terminal</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"24048469582011523000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`cd ios\nbundle install\nbundle exec pod install`, `24048469582011523000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> ios\nbundle <span class=\"token function\">install</span>\nbundle <span class=\"token builtin class-name\">exec</span> pod <span class=\"token function\">install</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>That's it for the configuration. Commit the modifications into your source control repository.</p>\n<p>Before you build and archive the app, you can run the following to build the Pods and inject the built artifacts before you archive the app.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">terminal</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"12752923511281056000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`bundle exec xcode-archive-cache inject --configuration=release --storage=&quot;\\$HOME/build_cache&quot;`, `12752923511281056000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">bundle <span class=\"token builtin class-name\">exec</span> xcode-archive-cache inject <span class=\"token parameter variable\">--configuration</span><span class=\"token operator\">=</span>release <span class=\"token parameter variable\">--storage</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token environment constant\">$HOME</span>/build_cache\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<blockquote>\n<p>One thing to note is that you do not need to commit the changed project files after you inject the build artifacts. You are supposed to discard the changes.\nThis works very well especially when you need to reduce the time taken for repetitive builds for QA/Regression testing.</p>\n</blockquote>\n<p>You can verify the the time it takes to build by appending the <code class=\"language-text\">time</code> command infront of the <code class=\"language-text\">xcodebuild</code> command.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">terminal</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"69013937450894410000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`time xcodebuild -workspace ios/kopirun.xcworkspace -scheme kopirun -sdk iphoneos -configuration Release archive -archivePath \\$PWD/ios/build/kopirun.xcarchive`, `69013937450894410000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">time</span> xcodebuild <span class=\"token parameter variable\">-workspace</span> ios/kopirun.xcworkspace <span class=\"token parameter variable\">-scheme</span> kopirun <span class=\"token parameter variable\">-sdk</span> iphoneos <span class=\"token parameter variable\">-configuration</span> Release archive <span class=\"token parameter variable\">-archivePath</span> <span class=\"token environment constant\">$PWD</span>/ios/build/kopirun.xcarchive</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>You can use the above configuration in combination with my post on <a href=\"/blog/appcenter-caching-vendor-libraries\">AppCenter caching for Vendor libraries</a> and <a href=\"/blog/speed-up-react-native-appcenter-builds\">Speed Up React Native builds in AppCenter</a></p>","headings":[{"id":"Journey","value":"Journey","depth":1},{"id":"Solve","value":"Solve","depth":1}],"excerpt":"The first post about reducing build times for xcode was written at Reduce React Native XCode build time. Since then, the author who made  has updated the tool and added support for XCFrameworks. This allows it to work with  and any XCode project that…","timeToRead":2,"frontmatter":{"date":"06 September, 2021","updatedAt":null,"slug":"reduce-react-native-xcode-build-time-encore","title":"Reduce React Native XCode build time Encore","tags":["xcode","mobile app","ios","react-native","dev ops"],"featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA00lEQVR42mOQnP0aB3olOeuVyNwPknPe4FLDgFVUavZr0bkfBGe9N23fKTHlocTc9yCziNEM1Ck2+63a5Kt2PXviy1pN+46JzXolRZzNryTnvhfvu7588+6bV65cu3SxYsFOvinPpOe+IaxZavYr8bkfFLrOnjx56vrtBw9u3shacoJ36guZOW+Icrb03LeCkx71Ld369Oalxzevrli3RbTvhuQ8LN7G6udXIrPfa0+8EDdzX9zsgzaTT4nMeiNFUmiLzXnHN/Md/8z3IrPfSeGIKgDOFgnw6H28cgAAAABJRU5ErkJggg=="},"backgroundColor":"transparent","images":{"fallback":{"src":"/static/b71a4681fa4905fffb002fd29b9cf0fd/6fc77/reduce-react-native-xcode-build-time.png","srcSet":"/static/b71a4681fa4905fffb002fd29b9cf0fd/85ced/reduce-react-native-xcode-build-time.png 800w,\n/static/b71a4681fa4905fffb002fd29b9cf0fd/7c498/reduce-react-native-xcode-build-time.png 1080w,\n/static/b71a4681fa4905fffb002fd29b9cf0fd/6fc77/reduce-react-native-xcode-build-time.png 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/b71a4681fa4905fffb002fd29b9cf0fd/28281/reduce-react-native-xcode-build-time.webp 800w,\n/static/b71a4681fa4905fffb002fd29b9cf0fd/0b5d5/reduce-react-native-xcode-build-time.webp 1080w,\n/static/b71a4681fa4905fffb002fd29b9cf0fd/a020d/reduce-react-native-xcode-build-time.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":500}}}}},"comments":{"edges":[{"node":{"id":"22ed4c94-d6fe-53db-88f7-213bc9b4d6c5","slug":"reduce-react-native-xcode-build-time-encore","name":"Dox","date":"11 March, 2022 at 4:03 PM","message":"Hey! Nice article. I tried your cacheclean implementation first, do you think I should remove it? Can they both work together?\n\nThanks!"}},{"node":{"id":"cbe40b55-b5d7-5e5b-99de-61a3c902bbcc","slug":"reduce-react-native-xcode-build-time-encore","name":"Zane","date":"12 March, 2022 at 2:03 AM","message":"That's a mighty good question Dox. Honestly I never tried both. I think it might work but I would caution the use of multiple level of caches as you might end up with some unwanted behaviour. I think using just xcode-archive-cache is good enough for me."}},{"node":{"id":"562b44a7-3592-5fa7-a041-ca0bd04f093d","slug":"reduce-react-native-xcode-build-time-encore","name":"Dox","date":"15 March, 2022 at 3:03 PM","message":"Thanks Zane! Allright, so, for removing the other implementation I just have to remove the post_install script, right?\n\ninstaller.pods_project.targets.each do |target|\n  target.build_configurations.each do |config|\n    config.build_settings[\"CC\"] = \"clang\"\n    config.build_settings[\"LD\"] = \"clang\"\n    config.build_settings[\"CXX\"] = \"clang++\"\n    config.build_settings[\"LDPLUSPLUS\"] = \"clang++\"\n  end\nend\n\nAnd, another one; Im having this error on xcode with the xcode-archive-cache implementation:\n\nLibrary not found for -lPods-exampleapp\n\nHow can I reset the cache for this implementation?\n\nThanks"}},{"node":{"id":"40f7b517-4556-5785-beb1-1d8cf48f1995","slug":"reduce-react-native-xcode-build-time-encore","name":"Zane","date":"16 March, 2022 at 1:03 AM","message":"Yes, please remove the changes you made for the ccache implementation.\n\nI actually linked the xcode-archive-cache issue ticket that has instructions on how to get you setup for a bare react native project, did you try that yet?\n\nThe cache for this implementation is only meant to be used to build and you discard all the changes it makes to your xcode projects afterwards. Do not commit the changes to those files into the git repo.\n\nAt which point do you get that error message?"}},{"node":{"id":"195a3e05-b23d-5dcc-adec-755eaeb40d9b","slug":"reduce-react-native-xcode-build-time-encore","name":"Dox","date":"16 March, 2022 at 4:03 PM","message":"Thanks for the quick response! \n\nIm trying to debug the error still, I think its because of a cache error, huh!\n\nWhen you say to not commit the files, you mean the Gemfile and the Cachefile?"}},{"node":{"id":"d99765ea-4c92-5b4e-b4c7-15cefe8a8f83","slug":"reduce-react-native-xcode-build-time-encore","name":"Zane","date":"16 March, 2022 at 5:03 PM","message":"If you can share a sample project that replicates that error via GitHub, I can take a look.\n\nNo. Those files you'll have to commit. I meant the `project.pbxproj` that gets modified by the xcode-archive-cache command"}}]}},"pageContext":{"slug":"reduce-react-native-xcode-build-time-encore"}},"staticQueryHashes":["3649515864","983108779"],"slicesMap":{}}
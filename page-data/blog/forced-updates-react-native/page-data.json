{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blog/forced-updates-react-native/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://zanechua.com"}},"posts":{"html":"<p>How do you ensure your mobile application does not crash and burn when you need to make breaking changes to your backend code, which may including updating the graphql schema or even REST API endpoints or more?</p>\n<p>It is easy to achieve on a web application as you can control the deployments for both the web application and the backend service. However, when it comes to mobile applications, the release schedule is not controlled by you as it is controlled by the respective application store owners, Apple for the App Store and Google for the Google Play Store.</p>\n<h1 id=\"Journey\" style=\"position:relative;\">Journey<a href=\"#Journey\" aria-label=\"Journey permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>Research is always the first step to discover any solution to the problem you are having, this was no different. Research landed me on Feature Flags which could potentially be used to solve the problem as you could add a feature flag which only allowed the \"new\" code or the existing code to be run if the feature flag was enabled or not.</p>\n<p>However, using feature flags to solve the problem is cumbersome when you want to make changes in multiple places or when a user hasn't updated their mobile application and their version is so backward that the mobile application is sure to crash resulting in a bad user experience.</p>\n<p>We were already using semantic versioning on both the mobile application and the backend service, so it would be easy for us to sync both versions and have them depend on semantic versioning to determine if an upgrade was required.</p>\n<p>I designed a simple <code class=\"language-text\">JSON</code> format to store information such as the service, the environments, the version of the application and when they were last updated at.</p>\n<p>This allowed me to write some pretty simple code to ping an endpoint to get the <code class=\"language-text\">JSON</code> payload and determine if that has been a major version change or not.</p>\n<h1 id=\"Solve\" style=\"position:relative;\">Solve<a href=\"#Solve\" aria-label=\"Solve permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>The following file is a sample of the kind of data that we are using to determine if a forced update is necessary. The file is updated in multiple ways:</p>\n<ul>\n<li>A scheduled job in GitLab will run every hour to determine the current state of the mobile application in both the iOS and Android application stores</li>\n<li>An upstream pipeline that conducts a deployment will trigger the downstream pipeline to run and update the state.</li>\n</ul>\n<p>You have to host the file at an endpoint e.g. <code class=\"language-text\">version.example.com</code>. You can simply use any of the static website providers like Netlify or GitHub/GitLab pages.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">versioning-state.json</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"7718052884155213000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`{\n  &quot;app&quot;: {\n    &quot;production&quot;: {\n      &quot;ios&quot;: {\n        &quot;version&quot;: &quot;6.1.0&quot;,\n        &quot;releasedAt&quot;: &quot;2022-08-17T04:05:03.000Z&quot;,\n        &quot;notes&quot;: &quot;We’re about to take group buying to the next level. This release is in preparation for our store and payments integration. Soon, you’ll be able to host group buys for KopiRun supported stores. You and your group will enjoy free delivery, non-jacked up menu prices and discounts on top of that!\\nSneak peek of the latest features: - Direct store integration with supported businesses - Place orders for products - Payments integration with PayNow (Only in Singapore)&quot;,\n        &quot;url&quot;: &quot;https://apps.apple.com/us/app/kopirun/id1512434287?uo=4&quot;,\n        &quot;updatedAt&quot;: &quot;2022-08-17T17:06:17.682Z&quot;\n      },\n      &quot;android&quot;: {\n        &quot;version&quot;: &quot;6.1.0&quot;,\n        &quot;releasedAt&quot;: &quot;2022-08-16T13:44:43.000Z&quot;,\n        &quot;notes&quot;: &quot;We’re about to take group buying to the next level. This release is in preparation for our store and payments integration. Soon, you’ll be able to host group buys for KopiRun supported stores. You and your group will enjoy free delivery, non-jacked up menu prices and discounts on top of that!\\nSneak peek of the latest features: - Direct store integration with supported businesses - Place orders for products - Payments integration with PayNow (Only in Singapore) &quot;,\n        &quot;url&quot;: &quot;https://play.google.com/store/apps/details?id=com.kopirun.app&hl=en&gl=us&quot;,\n        &quot;updatedAt&quot;: &quot;2022-08-17T17:06:17.847Z&quot;\n      }\n    },\n    &quot;development&quot;: {\n      &quot;version&quot;: &quot;1.0.0&quot;,\n      &quot;updatedAt&quot;: &quot;2021-10-22T16:37:44.168Z&quot;\n    },\n    &quot;review&quot;: {\n      &quot;version&quot;: &quot;1.0.0&quot;,\n      &quot;updatedAt&quot;: &quot;2021-10-22T16:37:44.168Z&quot;\n    },\n    &quot;regression&quot;: {\n      &quot;version&quot;: &quot;1.0.0&quot;,\n      &quot;updatedAt&quot;: &quot;2021-10-22T16:37:44.168Z&quot;\n    }\n  },\n  &quot;backend&quot;: {\n    &quot;production&quot;: {\n      &quot;version&quot;: &quot;6.8.3&quot;,\n      &quot;updatedAt&quot;: &quot;2022-09-07T16:25:31.504Z&quot;\n    },\n    &quot;development&quot;: {\n      &quot;version&quot;: &quot;6.8.2&quot;,\n      &quot;updatedAt&quot;: &quot;2022-08-30T17:15:04.565Z&quot;\n    },\n    &quot;review&quot;: {\n      &quot;version&quot;: &quot;6.8.2&quot;,\n      &quot;updatedAt&quot;: &quot;2022-08-30T17:18:04.810Z&quot;\n    },\n    &quot;regression&quot;: {\n      &quot;version&quot;: &quot;6.8.2&quot;,\n      &quot;updatedAt&quot;: &quot;2022-08-30T17:15:33.727Z&quot;\n    }\n  },\n}`, `7718052884155213000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"app\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"production\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"ios\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"6.1.0\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"releasedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2022-08-17T04:05:03.000Z\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"notes\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"We’re about to take group buying to the next level. This release is in preparation for our store and payments integration. Soon, you’ll be able to host group buys for KopiRun supported stores. You and your group will enjoy free delivery, non-jacked up menu prices and discounts on top of that!\\nSneak peek of the latest features: - Direct store integration with supported businesses - Place orders for products - Payments integration with PayNow (Only in Singapore)\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://apps.apple.com/us/app/kopirun/id1512434287?uo=4\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"updatedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2022-08-17T17:06:17.682Z\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"android\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"6.1.0\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"releasedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2022-08-16T13:44:43.000Z\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"notes\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"We’re about to take group buying to the next level. This release is in preparation for our store and payments integration. Soon, you’ll be able to host group buys for KopiRun supported stores. You and your group will enjoy free delivery, non-jacked up menu prices and discounts on top of that!\\nSneak peek of the latest features: - Direct store integration with supported businesses - Place orders for products - Payments integration with PayNow (Only in Singapore) \"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://play.google.com/store/apps/details?id=com.kopirun.app&amp;hl=en&amp;gl=us\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"updatedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2022-08-17T17:06:17.847Z\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"development\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"updatedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-10-22T16:37:44.168Z\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"review\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"updatedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-10-22T16:37:44.168Z\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"regression\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"updatedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-10-22T16:37:44.168Z\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"backend\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"production\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"6.8.3\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"updatedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2022-09-07T16:25:31.504Z\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"development\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"6.8.2\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"updatedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2022-08-30T17:15:04.565Z\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"review\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"6.8.2\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"updatedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2022-08-30T17:18:04.810Z\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"regression\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"6.8.2\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"updatedAt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2022-08-30T17:15:33.727Z\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>We used the following code to basically call the endpoint for the <code class=\"language-text\">JSON</code> state and determine if an application needs to be upgraded as long as the major versions differ in the backend and the mobile application.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">updateChecker.js</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"29788525407431330000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`import { Platform } from 'react-native';\nimport { version } from 'root/package.json';\nimport semver from 'semver';\n\nconst updateAvailable = async () => {\n  try {\n    const response = await fetch('https://version.example.com');\n    const updateData = await response.json();\n    let versionData;\n\n    if (semver.valid(version)) {\n      if (Platform.OS === 'ios') {\n        versionData = updateData?.app?.production?.ios;\n      }\n\n      if (Platform.OS === 'android') {\n        versionData = updateData?.app?.production?.android;\n      }\n\n      const versionToCheck = versionData?.version;\n\n      // Force update for major versions\n      if (semver.valid(versionToCheck)) {\n        const majorVersion = semver.major(versionToCheck);\n        return !semver.satisfies(version, \\`>=\\${majorVersion}.0.0\\`);\n      }\n    }\n  } catch (error) {\n    console.log(error);\n  }\n\n  return false;\n};\n\nexport default updateAvailable;\nexport { updateAvailable };`, `29788525407431330000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Platform <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-native'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> version <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'root/package.json'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> semver <span class=\"token keyword\">from</span> <span class=\"token string\">'semver'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">updateAvailable</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://version.example.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> updateData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> versionData<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>semver<span class=\"token punctuation\">.</span><span class=\"token function\">valid</span><span class=\"token punctuation\">(</span>version<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Platform<span class=\"token punctuation\">.</span><span class=\"token constant\">OS</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ios'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        versionData <span class=\"token operator\">=</span> updateData<span class=\"token operator\">?.</span>app<span class=\"token operator\">?.</span>production<span class=\"token operator\">?.</span>ios<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Platform<span class=\"token punctuation\">.</span><span class=\"token constant\">OS</span> <span class=\"token operator\">===</span> <span class=\"token string\">'android'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        versionData <span class=\"token operator\">=</span> updateData<span class=\"token operator\">?.</span>app<span class=\"token operator\">?.</span>production<span class=\"token operator\">?.</span>android<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">const</span> versionToCheck <span class=\"token operator\">=</span> versionData<span class=\"token operator\">?.</span>version<span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Force update for major versions</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>semver<span class=\"token punctuation\">.</span><span class=\"token function\">valid</span><span class=\"token punctuation\">(</span>versionToCheck<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> majorVersion <span class=\"token operator\">=</span> semver<span class=\"token punctuation\">.</span><span class=\"token function\">major</span><span class=\"token punctuation\">(</span>versionToCheck<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span>semver<span class=\"token punctuation\">.</span><span class=\"token function\">satisfies</span><span class=\"token punctuation\">(</span>version<span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">>=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>majorVersion<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.0.0</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> updateAvailable<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> updateAvailable <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here's the application screen that we show to users who require an update of the mobile application.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">screens/UpdateAppScreen.js</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"19780307129843890000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`import React from 'react';\nimport { Linking, Platform, StyleSheet, Text, View } from 'react-native';\nimport Logo from 'assets/logo.svg';\nimport { Colors, Layouts, Palette } from 'styles';\n\nimport PrimaryButton from 'components/buttons/PrimaryButton';\n\nconst UpdateAppScreen = props => {\n  const appStoreUrl = 'appstore app url';\n  const playStoreUrl = 'playstore app url';\n  return (\n    <View style={[Layouts.centeredSectionWithPadding, { backgroundColor: Colors.white }]}>\n      <Logo fill={Colors.black} height={150} width={150} />\n      <Text style={[Palette.heading, Layouts.marginTop.md]}>\n        We've got a newer, better version of App.\n      </Text>\n      <Text style={[Palette.boldtext, Layouts.marginTop.md]}>\n        Your app needs to be updated to get the latest features.\n      </Text>\n      <PrimaryButton\n        color={Colors.coral}\n        style={styles.button}\n        text=&quot;Update App&quot;\n        onPress={() =>\n          Platform.OS === 'ios' ? Linking.openURL(appStoreUrl) : Linking.openURL(playStoreUrl)\n        }\n      />\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  button: {\n    backgroundColor: Colors.coral,\n    marginTop: Layouts.margin.md,\n    paddingHorizontal: Layouts.padding.lg\n  }\n});\n\nexport default UpdateAppScreen;`, `19780307129843890000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Linking<span class=\"token punctuation\">,</span> Platform<span class=\"token punctuation\">,</span> StyleSheet<span class=\"token punctuation\">,</span> Text<span class=\"token punctuation\">,</span> View <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-native'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Logo <span class=\"token keyword\">from</span> <span class=\"token string\">'assets/logo.svg'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Colors<span class=\"token punctuation\">,</span> Layouts<span class=\"token punctuation\">,</span> Palette <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'styles'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> PrimaryButton <span class=\"token keyword\">from</span> <span class=\"token string\">'components/buttons/PrimaryButton'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">UpdateAppScreen</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> appStoreUrl <span class=\"token operator\">=</span> <span class=\"token string\">'appstore app url'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> playStoreUrl <span class=\"token operator\">=</span> <span class=\"token string\">'playstore app url'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>View style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>Layouts<span class=\"token punctuation\">.</span>centeredSectionWithPadding<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> Colors<span class=\"token punctuation\">.</span>white <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Logo fill<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>Colors<span class=\"token punctuation\">.</span>black<span class=\"token punctuation\">}</span> height<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">150</span><span class=\"token punctuation\">}</span> width<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">150</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Text style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>Palette<span class=\"token punctuation\">.</span>heading<span class=\"token punctuation\">,</span> Layouts<span class=\"token punctuation\">.</span>marginTop<span class=\"token punctuation\">.</span>md<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        We've got a newer<span class=\"token punctuation\">,</span> better version <span class=\"token keyword\">of</span> App<span class=\"token punctuation\">.</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Text<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Text style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>Palette<span class=\"token punctuation\">.</span>boldtext<span class=\"token punctuation\">,</span> Layouts<span class=\"token punctuation\">.</span>marginTop<span class=\"token punctuation\">.</span>md<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        Your app needs to be updated to <span class=\"token keyword\">get</span> the latest features<span class=\"token punctuation\">.</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Text<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>PrimaryButton\n        color<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>Colors<span class=\"token punctuation\">.</span>coral<span class=\"token punctuation\">}</span>\n        style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>button<span class=\"token punctuation\">}</span>\n        text<span class=\"token operator\">=</span><span class=\"token string\">\"Update App\"</span>\n        onPress<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n          Platform<span class=\"token punctuation\">.</span><span class=\"token constant\">OS</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ios'</span> <span class=\"token operator\">?</span> Linking<span class=\"token punctuation\">.</span><span class=\"token function\">openURL</span><span class=\"token punctuation\">(</span>appStoreUrl<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> Linking<span class=\"token punctuation\">.</span><span class=\"token function\">openURL</span><span class=\"token punctuation\">(</span>playStoreUrl<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>View<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> styles <span class=\"token operator\">=</span> StyleSheet<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">button</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> Colors<span class=\"token punctuation\">.</span>coral<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">marginTop</span><span class=\"token operator\">:</span> Layouts<span class=\"token punctuation\">.</span>margin<span class=\"token punctuation\">.</span>md<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">paddingHorizontal</span><span class=\"token operator\">:</span> Layouts<span class=\"token punctuation\">.</span>padding<span class=\"token punctuation\">.</span>lg\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> UpdateAppScreen<span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>We used the <code class=\"language-text\">@react-navigation</code> package to handle navigation within the mobile application and thus this is the place where we want to force users to go into the update screen as it is one of the very early points of entry into the mobile application.</p>\n<p>Basically there's a <code class=\"language-text\">useEffect</code> that runs the moment the <code class=\"language-text\">navigator</code> is instantiated, and it returns a <code class=\"language-text\">boolean</code> which is then set to a state variable to determine if the mobile application needs to be updated or not.</p>\n<p>If it does, it will show the update screen and only the update screen, otherwise it will show the normal navigation components.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">navigator.js</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"56752871706110300000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`import { updateAvailable } from 'utilities/updateChecker';\nimport UpdateAppScreen from 'screens/UpdateAppScreen';\n\nconst Navigator = () => {\n  const [shouldUpdate, setShouldUpdate] = useState(false);\n\n  useEffect(() => {\n    async function checkIfUpdateAvailable() {\n      setShouldUpdate(await updateAvailable());\n    }\n    checkIfUpdateAvailable();\n  }, []);\n\n  return shouldUpdate ? (\n  <NavigationContainer>\n    <RootStack.Navigator screenOptions={{ headerShown: false }}>\n      <RootStack.Screen component={UpdateAppScreen} name=&quot;UpdateApp&quot; />\n    </RootStack.Navigator>\n  </NavigationContainer>\n  ) : (\n  <NavigationContainer>\n    <RootStack.Navigator screenOptions={{ headerShown: false }}>\n      ...\n    </RootStack.Navigator>\n  </NavigationContainer>\n  )\n}`, `56752871706110300000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> updateAvailable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'utilities/updateChecker'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> UpdateAppScreen <span class=\"token keyword\">from</span> <span class=\"token string\">'screens/UpdateAppScreen'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Navigator</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>shouldUpdate<span class=\"token punctuation\">,</span> setShouldUpdate<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">checkIfUpdateAvailable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setShouldUpdate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">updateAvailable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">checkIfUpdateAvailable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> shouldUpdate <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>NavigationContainer<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>RootStack<span class=\"token punctuation\">.</span>Navigator screenOptions<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">headerShown</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>RootStack<span class=\"token punctuation\">.</span>Screen component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>UpdateAppScreen<span class=\"token punctuation\">}</span> name<span class=\"token operator\">=</span><span class=\"token string\">\"UpdateApp\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>RootStack<span class=\"token punctuation\">.</span>Navigator<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>NavigationContainer<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>NavigationContainer<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>RootStack<span class=\"token punctuation\">.</span>Navigator screenOptions<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">headerShown</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">...</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>RootStack<span class=\"token punctuation\">.</span>Navigator<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>NavigationContainer<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","headings":[{"id":"Journey","value":"Journey","depth":1},{"id":"Solve","value":"Solve","depth":1}],"excerpt":"How do you ensure your mobile application does not crash and burn when you need to make breaking changes to your backend code, which may including updating the graphql schema or even REST API endpoints or more? It is easy to achieve on a web…","timeToRead":5,"frontmatter":{"date":"10 July, 2023","updatedAt":null,"slug":"forced-updates-react-native","title":"Forced updates with React Native app","tags":["node","dev ops","ci cd","automation","react native","javascript"],"featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAm0lEQVR42mOY6OCCC81wdp/u7I5HAQMuicmOrgk6+lkGxpNI0jzB3nmqk3uxockSHeVluirFhsZALlCQOM0OLlOd3EpNzHeZ6uw01S42Npvm5DaBWJvBbi4zMfdRUg1UUW+2spvk4EqCZqDNuQbGcVo6sZo6WfqGJNgMCa16C5sGC5tac+syE4spjq4TSArtSY6uk8EIqBNXaAMAMvWoi7ZN+XsAAAAASUVORK5CYII="},"backgroundColor":"transparent","images":{"fallback":{"src":"/static/cca3ffcea3f06bc8e4ab61762549e76f/6fc77/forced-updates-react-native.png","srcSet":"/static/cca3ffcea3f06bc8e4ab61762549e76f/85ced/forced-updates-react-native.png 800w,\n/static/cca3ffcea3f06bc8e4ab61762549e76f/7c498/forced-updates-react-native.png 1080w,\n/static/cca3ffcea3f06bc8e4ab61762549e76f/6fc77/forced-updates-react-native.png 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/cca3ffcea3f06bc8e4ab61762549e76f/28281/forced-updates-react-native.webp 800w,\n/static/cca3ffcea3f06bc8e4ab61762549e76f/0b5d5/forced-updates-react-native.webp 1080w,\n/static/cca3ffcea3f06bc8e4ab61762549e76f/a020d/forced-updates-react-native.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":500}}}}},"comments":{"edges":[{"node":{"id":"02cdd9da-4622-5cd8-b79d-10fd235e0c2b","slug":"forced-updates-react-native","name":"Emily Kinney","date":"31 March, 2025 at 6:03 PM","message":"the fonts of the site look very small on a 1080p screen, my eyes don't see as well as yours"}},{"node":{"id":"daa9ba8e-8678-5447-844b-a62bf455addc","slug":"forced-updates-react-native","name":"Zane","date":"23 June, 2025 at 12:06 PM","message":"@ Emily Kinney\n\nThanks for the feedback. I checked my configuration, and the default font size is 16px which should be in line with many different frameworks as the base size."}}]}},"pageContext":{"slug":"forced-updates-react-native"}},"staticQueryHashes":["3649515864","983108779"],"slicesMap":{}}
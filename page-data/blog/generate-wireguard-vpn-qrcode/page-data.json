{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blog/generate-wireguard-vpn-qrcode/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://zanechua.com"}},"posts":{"html":"<p>I needed our dev and testers at <a href=\"https://kopirun.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">KopiRun</a>'s to access certain resources securely without having to expose those resources publicly. I think the default choice for organisations would be to use VPNs and wireguard is a very popular choice these days due to it's benefits over OpenVPN.</p>\n<p>I was finding it a chore to have to generate credentials for each user so I wrote up a simple script that will generate a public and private keypair; wire guard configuration; QR Code into a folder so that you can easily zip the folder up and send it over to the recipient as their VPN deployment package. Alternatively, they can just scan the QR Code in the folder and that would be sufficient too.</p>\n<blockquote>\n<p>The generated QR Code contains the private key that is generated, please treat these QR Codes the same as you would passwords.</p>\n</blockquote>\n<h1 id=\"Solve\" style=\"position:relative;\">Solve<a href=\"#Solve\" aria-label=\"Solve permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">terminal</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"49511815177194226000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`sudo apt install wireguard qrencode #assuming debian/ubuntu`, `49511815177194226000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> wireguard qrencode <span class=\"token comment\">#assuming debian/ubuntu</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ol>\n<li>Create directory from supplied value</li>\n<li>Generate public and private key pair and print public key out</li>\n<li>Look for the text <code class=\"language-text\">privatekeytoreplace</code> and replace it with private key generated in step 2.</li>\n<li>Generate a QR Code based off the client configuration and save as png</li>\n</ol>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">genclient.sh</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"7444473103964677000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`#!/bin/sh\nIP_RANGE=192.168.100.0\nCURRENT_IP=\\$(cat state)\nCN=&quot;\\${CURRENT_IP##*.}&quot;\nNEW_IP=192.168.100.\\$((\\$CN + 1))\n\nmkdir \\$1\nwg genkey | tee ./\\$1/client.key |  wg pubkey | tee ./\\$1/client.key.pub | awk '/^/{print &quot;Public Key: &quot;\\$1}'\ncp client.conf ./\\$1/client.conf\nsed -i 's~privatekeytoreplace~'\\$(cat ./\\$1/client.key)'~g' ./\\$1/client.conf\nsed -i 's~'&quot;\\$IP_RANGE&quot;'~'&quot;\\$NEW_IP&quot;'~g' ./\\$1/client.conf\nqrencode -o ./\\$1/client.png < ./\\$1/client.conf\necho \\$NEW_IP > state`, `7444473103964677000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n<span class=\"token assign-left variable\">IP_RANGE</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.100.0\n<span class=\"token assign-left variable\">CURRENT_IP</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">cat</span> state<span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">CN</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${CURRENT_IP<span class=\"token operator\">##</span>*.}</span>\"</span>\n<span class=\"token assign-left variable\">NEW_IP</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.100.<span class=\"token variable\"><span class=\"token variable\">$((</span>$CN <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token variable\">))</span></span>\n\n<span class=\"token function\">mkdir</span> <span class=\"token variable\">$1</span>\nwg genkey <span class=\"token operator\">|</span> <span class=\"token function\">tee</span> ./<span class=\"token variable\">$1</span>/client.key <span class=\"token operator\">|</span>  wg pubkey <span class=\"token operator\">|</span> <span class=\"token function\">tee</span> ./<span class=\"token variable\">$1</span>/client.key.pub <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'/^/{print \"Public Key: \"$1}'</span>\n<span class=\"token function\">cp</span> client.conf ./<span class=\"token variable\">$1</span>/client.conf\n<span class=\"token function\">sed</span> <span class=\"token parameter variable\">-i</span> <span class=\"token string\">'s~privatekeytoreplace~'</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">cat</span> ./$1/client.key<span class=\"token variable\">)</span></span><span class=\"token string\">'~g'</span> ./<span class=\"token variable\">$1</span>/client.conf\n<span class=\"token function\">sed</span> <span class=\"token parameter variable\">-i</span> <span class=\"token string\">'s~'</span><span class=\"token string\">\"<span class=\"token variable\">$IP_RANGE</span>\"</span>'~<span class=\"token string\">'\"$NEW_IP\"'</span>~g' ./<span class=\"token variable\">$1</span>/client.conf\nqrencode <span class=\"token parameter variable\">-o</span> ./<span class=\"token variable\">$1</span>/client.png <span class=\"token operator\">&lt;</span> ./<span class=\"token variable\">$1</span>/client.conf\n<span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$NEW_IP</span> <span class=\"token operator\">></span> state</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">client.conf</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"48778260549030765000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`[Interface]\nPrivateKey = privatekeytoreplace\nAddress = 192.168.100.0/24\nDNS = 1.1.1.1\n\n[Peer]\nPublicKey = publickeytofill\nAllowedIPs = 192.168.200.8/32\nEndpoint = wireguard.example.com:51820`, `48778260549030765000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"systemd\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-systemd line-numbers\"><code class=\"language-systemd\"><span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">Interface</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">PrivateKey</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">privatekeytoreplace</span>\n<span class=\"token key attr-name\">Address</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">192.168.100.0/24</span>\n<span class=\"token key attr-name\">DNS</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">1.1.1.1</span>\n\n<span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">Peer</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">PublicKey</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">publickeytofill</span>\n<span class=\"token key attr-name\">AllowedIPs</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">192.168.200.8/32</span>\n<span class=\"token key attr-name\">Endpoint</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">wireguard.example.com:51820</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Place both files into the same directory, update the public key, ip configuration and endpoint if you would like. Leave the private key field alone. Once done, you can run:</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">terminal</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"14149502474298049000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`./genclient.sh *usernamehere*`, `14149502474298049000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">./genclient.sh *usernamehere*</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>That will create a folder with <code class=\"language-text\">*usernamehere*</code> and the following files:</p>\n<ul>\n<li>client.conf (wireguard configuration)</li>\n<li>client.key (private key)</li>\n<li>client.key.pub (public key)</li>\n<li>client.png (qr code)</li>\n</ul>","excerpt":"I needed our dev and testers at KopiRun's to access certain resources securely without having to expose those resources publicly. I think the default choice for organisations would be to use VPNs and wireguard is a very popular choice these days due…","timeToRead":1,"frontmatter":{"date":"30 October, 2021","updatedAt":null,"slug":"generate-wireguard-vpn-qrcode","title":"Generate a WireGuard QR code deployment package for easy onboarding","tags":["homelab","infrastructure","vpn","wireguard","sys ops"],"featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA1UlEQVR42mNok5DERC3CIk2CQk1Cwq2iYu2SUkCEVRkDplCrmPhMG7uVYWHrg4O6VVSbBASbBYXasOlH1wy0pFlYeJFfwLGOjrP1NZvzC2Y7OM5zdWsREcXUj1WzyCw7+y0FhVvy8talpu2sqlocEAi0v11Kmghni4otDQ7ZkJW9ODBoRXQMUP8MS6tmIeF2gjYD3dYiKtaroro1P39FWPi2/Pzp5haLfXyA4UeczeISHdIyi11dexQUFzg5TdDUWurh0UikZmhsiYpBSKBZzSJiWEMbACbZhKtlgIBbAAAAAElFTkSuQmCC"},"backgroundColor":"transparent","images":{"fallback":{"src":"/static/0879a77752273f5c476ea4baec16b272/6fc77/generate-wireguard-vpn-qrcode.png","srcSet":"/static/0879a77752273f5c476ea4baec16b272/85ced/generate-wireguard-vpn-qrcode.png 800w,\n/static/0879a77752273f5c476ea4baec16b272/7c498/generate-wireguard-vpn-qrcode.png 1080w,\n/static/0879a77752273f5c476ea4baec16b272/6fc77/generate-wireguard-vpn-qrcode.png 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/0879a77752273f5c476ea4baec16b272/28281/generate-wireguard-vpn-qrcode.webp 800w,\n/static/0879a77752273f5c476ea4baec16b272/0b5d5/generate-wireguard-vpn-qrcode.webp 1080w,\n/static/0879a77752273f5c476ea4baec16b272/a020d/generate-wireguard-vpn-qrcode.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":500}}}}},"comments":{"edges":[]}},"pageContext":{"slug":"generate-wireguard-vpn-qrcode"}},"staticQueryHashes":["3649515864","983108779"],"slicesMap":{}}
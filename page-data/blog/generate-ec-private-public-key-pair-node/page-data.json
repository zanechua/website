{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blog/generate-ec-private-public-key-pair-node/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://zanechua.com"}},"posts":{"html":"<p>Some of my projects are leveraging the <a href=\"https://github.com/auth0/node-jsonwebtoken\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">jsonwebtoken</a> package to issue JWTs as access tokens to our users. The package itself requires private and public key pairs to be generated and accepts a few types of keys. One of them is an EC key pair with the <code class=\"language-text\">secp521r1</code> curve. This can be easily generated in openssl with the following commands</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">terminal</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"41789268826632544000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`openssl ecparam -genkey -name secp521r1 -noout -out ./ecdsa-p521-private.pem\nopenssl ec -in ./ecdsa-p521-private.pem -pubout -out ./ecdsa-p521-public.pem`, `41789268826632544000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">openssl ecparam <span class=\"token parameter variable\">-genkey</span> <span class=\"token parameter variable\">-name</span> secp521r1 <span class=\"token parameter variable\">-noout</span> <span class=\"token parameter variable\">-out</span> ./ecdsa-p521-private.pem\nopenssl ec <span class=\"token parameter variable\">-in</span> ./ecdsa-p521-private.pem <span class=\"token parameter variable\">-pubout</span> <span class=\"token parameter variable\">-out</span> ./ecdsa-p521-public.pem</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>However, this required me to install a dependency in my GitLab pipeline for the scaffolding I needed for my test environment. I set out to figure out if I could generate these keys with the NodeJS <code class=\"language-text\">crypto</code> module itself.</p>\n<h1 id=\"Journey\" style=\"position:relative;\">Journey<a href=\"#Journey\" aria-label=\"Journey permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>So after some basic googling, I landed on the following two articles:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/74942424/how-to-convert-ecdh-keys-to-pem-format-with-nodejs-crypto-module\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://stackoverflow.com/questions/74942424/how-to-convert-ecdh-keys-to-pem-format-with-nodejs-crypto-module</a></li>\n<li><a href=\"https://stackoverflow.com/questions/66382638/how-to-generate-private-ec-private-public-key-pair-in-der-format-using-node-js/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://stackoverflow.com/questions/66382638/how-to-generate-private-ec-private-public-key-pair-in-der-format-using-node-js/</a></li>\n</ul>\n<p>The first article essentially pointed me to the <code class=\"language-text\">generateKeyPairSync</code> function of the <code class=\"language-text\">crypto</code> module in node.</p>\n<p>I successfully built the first implementation that allowed me to achieve my original objective of generating an EC key pair with the <code class=\"language-text\">secp521r1</code> curve removing the need to install the <code class=\"language-text\">openssl</code> dependency on any of my docker containers or pipelines to generate the key pair.</p>\n<p>I then looked at the second article which wanted the public keys to be generated in a compressed format. The original poster had already found a solution for themselves by utilizing the <code class=\"language-text\">asn1.js</code> library and defining the schemas for it. I wanted to do it natively without having the need to install anything else.</p>\n<p>This brings me back to the last section of the answer in the first article where <code class=\"language-text\">Topaco</code> actually states that you can do so by essentially constructing the keys with the raw private and public keys along with the hardcoded metadata to form a valid EC key. The metadata is not consistent for all curves, it changes as long as the curve is different, whether it's a private or public key, whether the public key is compressed or not.</p>\n<p>I had posted an answer on the second article with my first implementation of thinking that that would be an alternative to the original poster's answer, but I missed out the requirement for the public key to be compressed.</p>\n<p>I could not figure out how to build the keys manually at the point of time with the first implementation, but I have since updated my answer to include a new implementation that allows you to generate compressed public keys with node, leveraging the <code class=\"language-text\">crypto</code> module without any external dependencies.</p>\n<h1 id=\"Solve\" style=\"position:relative;\">Solve<a href=\"#Solve\" aria-label=\"Solve permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>Here's the first implementation of my code which allows you to generate an EC key in PEM format depending on the curve you specify in the <code class=\"language-text\">curve</code> variable. Use this implementation if you do not care about compressed public keys.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">generateECKeys.js</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"91862325578174700000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`const crypto = require('crypto');\nconst fs = require('fs');\n\nif (process.argv.length < 3) {\n  console.log('Usage:\\r\\n\\r\\n' + 'node generateECKeys.js folder');\n  process.exit(1);\n}\n\nconst relativeDirectory = process.argv[2];\n\nconst regex = /.{64}/g;\n// Generate the private and public key\nconst curve = 'secp521r1';\nconst { publicKey, privateKey } = crypto.generateKeyPairSync('ec', { namedCurve: curve });\n\n// Export the private key\nconst privateKeyDer = privateKey.export({ type: 'sec1', format: 'der' }).toString('base64');\nconst formattedPrivateKey = privateKeyDer.replace(regex, '\\$&\\n');\n\n// Save the private key to a file\nfs.writeFileSync(\n  \\`\\${relativeDirectory}/ecdsa-p521-private.pem\\`,\n  \\`-----BEGIN EC PRIVATE KEY-----\\n\\${formattedPrivateKey}\\n-----END EC PRIVATE KEY-----\\n\\`\n);\n\n// Export the public key\nconst publicKeyDer = publicKey.export({ type: 'spki', format: 'der' }).toString('base64');\nconst formattedPublicKey = publicKeyDer.replace(regex, '\\$&\\n');\n\n// Save the public key to a file\nfs.writeFileSync(\n  \\`\\${relativeDirectory}/ecdsa-p521-public.pem\\`,\n  \\`-----BEGIN PUBLIC KEY-----\\n\\${formattedPublicKey}\\n-----END PUBLIC KEY-----\\n\\`\n);`, `91862325578174700000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Usage:\\r\\n\\r\\n'</span> <span class=\"token operator\">+</span> <span class=\"token string\">'node generateECKeys.js folder'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> relativeDirectory <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> regex <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.{64}</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Generate the private and public key</span>\n<span class=\"token keyword\">const</span> curve <span class=\"token operator\">=</span> <span class=\"token string\">'secp521r1'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> publicKey<span class=\"token punctuation\">,</span> privateKey <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">generateKeyPairSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ec'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">namedCurve</span><span class=\"token operator\">:</span> curve <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Export the private key</span>\n<span class=\"token keyword\">const</span> privateKeyDer <span class=\"token operator\">=</span> privateKey<span class=\"token punctuation\">.</span><span class=\"token function\">export</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'sec1'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">format</span><span class=\"token operator\">:</span> <span class=\"token string\">'der'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> formattedPrivateKey <span class=\"token operator\">=</span> privateKeyDer<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>regex<span class=\"token punctuation\">,</span> <span class=\"token string\">'$&amp;\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Save the private key to a file</span>\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span>\n  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>relativeDirectory<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/ecdsa-p521-private.pem</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">-----BEGIN EC PRIVATE KEY-----\\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>formattedPrivateKey<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\n-----END EC PRIVATE KEY-----\\n</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Export the public key</span>\n<span class=\"token keyword\">const</span> publicKeyDer <span class=\"token operator\">=</span> publicKey<span class=\"token punctuation\">.</span><span class=\"token function\">export</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'spki'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">format</span><span class=\"token operator\">:</span> <span class=\"token string\">'der'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> formattedPublicKey <span class=\"token operator\">=</span> publicKeyDer<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>regex<span class=\"token punctuation\">,</span> <span class=\"token string\">'$&amp;\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Save the public key to a file</span>\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span>\n  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>relativeDirectory<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/ecdsa-p521-public.pem</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">-----BEGIN PUBLIC KEY-----\\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>formattedPublicKey<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\n-----END PUBLIC KEY-----\\n</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This was the updated answer that I had posted to the second stackoverflow article which generates out an EC key pair with a compressed public key using the <code class=\"language-text\">secp256k1</code> curve</p>\n<p>You can save the private key into a pem file, feed it into <code class=\"language-text\">openssl</code> with the following command to validate if the associated public key is generated correctly in both a compressed or non-compressed format.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">terminal</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"7317418764100725000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`# Non Compressed Public Key\nopenssl pkey -pubout -in privatekey.pem\n\n# Compressed Public Key\nopenssl pkey -pubout -ec_conv_form compressed -in privatekey.pem`, `7317418764100725000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token comment\"># Non Compressed Public Key</span>\nopenssl pkey <span class=\"token parameter variable\">-pubout</span> <span class=\"token parameter variable\">-in</span> privatekey.pem\n\n<span class=\"token comment\"># Compressed Public Key</span>\nopenssl pkey <span class=\"token parameter variable\">-pubout</span> <span class=\"token parameter variable\">-ec_conv_form</span> compressed <span class=\"token parameter variable\">-in</span> privatekey.pem</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">generateECKeys.secp256k1.js</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"48029679218171940000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`// secp256k1\n\nconst crypto = require('node:crypto');\nconst ecdh = crypto.createECDH('secp256k1');\necdh.generateKeys();\n\nconst rawPrivate = ecdh.getPrivateKey('hex');\nconst rawPublic = ecdh.getPublicKey('hex', 'uncompressed');\n\nconst privKey = Buffer.from(rawPrivate, 'hex');\nconst pubKey = Buffer.from(rawPublic, 'hex'); // uncompressed\n\n// Build the private key\nconst privA = Buffer.from('30740201010420', 'hex');\nconst privB = Buffer.from('A00706052B8104000AA144034200', 'hex');\nconst privateKeyDer = Buffer.concat([privA, privKey, privB, pubKey]);\nconsole.log('Private Key ::');\nconsole.log(privateKeyDer.toString('base64'));\n// Private Key ::\n// MHQCAQEEICG7oP2vJzOrh3k7Q7PjZ5Yy91Kh0l5LldL2sHD57GwBoAcGBSuBBAAKoUQDQgAEgIjM+1h4s2JROafAyiiGlNooHwTBoKzDRVYAOwTNlpCudExqi5MxHXY3hwTuJOPN5rGJyMSZR/epTxQmmvWHCA==\n\n// Build the public key\nconst pubA = Buffer.from('3056301006072A8648CE3D020106052B8104000A034200', 'hex');\nconst publicKeyDer = Buffer.concat([pubA, pubKey]);\n\nconst rawCompressedPublic = ecdh.getPublicKey('hex', 'compressed');\nconst compressedPubKey = Buffer.from(rawCompressedPublic, 'hex'); // compressed\nconst compressedPubA = Buffer.from('3036301006072A8648CE3D020106052B8104000A032200', 'hex');\nconst compressedPublicKeyDer = Buffer.concat([compressedPubA, compressedPubKey]);\nconsole.log('Public Key ::');\nconsole.log(publicKeyDer.toString('base64'));\n\nconsole.log('Compressed Public Key ::');\nconsole.log(compressedPublicKeyDer.toString('base64'));\n// openssl pkey -pubout -in privatekey.pem\n// Public Key ::\n// MFYwEAYHKoZIzj0CAQYFK4EEAAoDQgAEgIjM+1h4s2JROafAyiiGlNooHwTBoKzDRVYAOwTNlpCudExqi5MxHXY3hwTuJOPN5rGJyMSZR/epTxQmmvWHCA==\n\n// openssl pkey -pubout -ec_conv_form compressed -in privatekey.pem\n// Compressed Public Key ::\n// MDYwEAYHKoZIzj0CAQYFK4EEAAoDIgACgIjM+1h4s2JROafAyiiGlNooHwTBoKzDRVYAOwTNlpA=`, `48029679218171940000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// secp256k1</span>\n\n<span class=\"token keyword\">const</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'node:crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> ecdh <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createECDH</span><span class=\"token punctuation\">(</span><span class=\"token string\">'secp256k1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\necdh<span class=\"token punctuation\">.</span><span class=\"token function\">generateKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> rawPrivate <span class=\"token operator\">=</span> ecdh<span class=\"token punctuation\">.</span><span class=\"token function\">getPrivateKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> rawPublic <span class=\"token operator\">=</span> ecdh<span class=\"token punctuation\">.</span><span class=\"token function\">getPublicKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'uncompressed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> privKey <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>rawPrivate<span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> pubKey <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>rawPublic<span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// uncompressed</span>\n\n<span class=\"token comment\">// Build the private key</span>\n<span class=\"token keyword\">const</span> privA <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'30740201010420'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> privB <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'A00706052B8104000AA144034200'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> privateKeyDer <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>privA<span class=\"token punctuation\">,</span> privKey<span class=\"token punctuation\">,</span> privB<span class=\"token punctuation\">,</span> pubKey<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Private Key ::'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>privateKeyDer<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Private Key ::</span>\n<span class=\"token comment\">// MHQCAQEEICG7oP2vJzOrh3k7Q7PjZ5Yy91Kh0l5LldL2sHD57GwBoAcGBSuBBAAKoUQDQgAEgIjM+1h4s2JROafAyiiGlNooHwTBoKzDRVYAOwTNlpCudExqi5MxHXY3hwTuJOPN5rGJyMSZR/epTxQmmvWHCA==</span>\n\n<span class=\"token comment\">// Build the public key</span>\n<span class=\"token keyword\">const</span> pubA <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'3056301006072A8648CE3D020106052B8104000A034200'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> publicKeyDer <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>pubA<span class=\"token punctuation\">,</span> pubKey<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> rawCompressedPublic <span class=\"token operator\">=</span> ecdh<span class=\"token punctuation\">.</span><span class=\"token function\">getPublicKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'compressed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> compressedPubKey <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>rawCompressedPublic<span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// compressed</span>\n<span class=\"token keyword\">const</span> compressedPubA <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'3036301006072A8648CE3D020106052B8104000A032200'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> compressedPublicKeyDer <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>compressedPubA<span class=\"token punctuation\">,</span> compressedPubKey<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Public Key ::'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>publicKeyDer<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Compressed Public Key ::'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>compressedPublicKeyDer<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// openssl pkey -pubout -in privatekey.pem</span>\n<span class=\"token comment\">// Public Key ::</span>\n<span class=\"token comment\">// MFYwEAYHKoZIzj0CAQYFK4EEAAoDQgAEgIjM+1h4s2JROafAyiiGlNooHwTBoKzDRVYAOwTNlpCudExqi5MxHXY3hwTuJOPN5rGJyMSZR/epTxQmmvWHCA==</span>\n\n<span class=\"token comment\">// openssl pkey -pubout -ec_conv_form compressed -in privatekey.pem</span>\n<span class=\"token comment\">// Compressed Public Key ::</span>\n<span class=\"token comment\">// MDYwEAYHKoZIzj0CAQYFK4EEAAoDIgACgIjM+1h4s2JROafAyiiGlNooHwTBoKzDRVYAOwTNlpA=</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I wanted to implement one which generates out an EC key pair with a compressed public key using the <code class=\"language-text\">secp521r1</code> curve and I did notice there was a difference in behaviour of the <code class=\"language-text\">rawPrivate</code> key when converted to a hex string. It would sometimes be missing a <code class=\"language-text\">01</code> from the hex string which would render the generated private key invalid.</p>\n<p>I added a simple test to add the <code class=\"language-text\">01</code> string if it was not present.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">generateECKeys.secp521r1.js</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"55627166021592560000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`// secp521r1\n\nconst crypto = require('node:crypto');\nconst ecdh = crypto.createECDH('secp521r1');\necdh.generateKeys();\n\nconst rawPrivate = ecdh.getPrivateKey('hex');\nconst rawPublic = ecdh.getPublicKey('hex', 'uncompressed');\n\nconst privKey = Buffer.from(rawPrivate, 'hex');\nconst pubKey = Buffer.from(rawPublic, 'hex'); // uncompressed\nconst privKeyHex = privKey.toString('hex');\n\n// Build the private key\nconst privA = Buffer.from(\\`3081DC0201010442\\${privKeyHex.startsWith('01') ? '' : '01'}\\`, 'hex');\nconst privB = Buffer.from('A00706052B81040023A1818903818600', 'hex');\nconst privateKeyDer = Buffer.concat([privA, privKey, privB, pubKey]);\nconsole.log('Private Key ::');\nconsole.log(privateKeyDer.toString('base64'));\n// Private Key ::\n// MIHcAgEBBEIBS++rLWx0TEghDwF+WM6t+16+t0dOXFwGiRR5D+ZFIFlTM4R92Y7isJEkh+sxgwsr6i9WfgKnhD9AyexaQQglkBygBwYFK4EEACOhgYkDgYYABAAXnp7e7jcLzVlf99dgcFECPOy09RriQtftEQZ+zKySsaKkQJzA2p7AEYessWluZ3jqvc2iOd23wbtAiz5Aac97/AE1BoNyj+ZOfMlnk1HN7TIAJfsViP75RSUOfnIXLMxh+6vmcOxsFg/2BrcSL9eVPEDRqPxX4cl9UmYQl3pz1CrTEw==\n\n// Build the public key\nconst pubA = Buffer.from('30819B301006072A8648CE3D020106052B8104002303818600', 'hex');\nconst publicKeyDer = Buffer.concat([pubA, pubKey]);\n\nconst rawCompressedPublic = ecdh.getPublicKey('hex', 'compressed');\nconst compressedPubKey = Buffer.from(rawCompressedPublic, 'hex'); // compressed\nconst compressedPubA = Buffer.from('3058301006072A8648CE3D020106052B81040023034400', 'hex');\nconst compressedPublicKeyDer = Buffer.concat([compressedPubA, compressedPubKey]);\nconsole.log('Public Key ::');\nconsole.log(publicKeyDer.toString('base64'));\n\nconsole.log('Compressed Public Key ::');\nconsole.log(compressedPublicKeyDer.toString('base64'));\n// openssl pkey -pubout -in privatekey.pem\n// Public Key ::\n// MIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQAF56e3u43C81ZX/fXYHBRAjzstPUa4kLX7REGfsyskrGipECcwNqewBGHrLFpbmd46r3Nojndt8G7QIs+QGnPe/wBNQaDco/mTnzJZ5NRze0yACX7FYj++UUlDn5yFyzMYfur5nDsbBYP9ga3Ei/XlTxA0aj8V+HJfVJmEJd6c9Qq0xM=\n\n// openssl pkey -pubout -ec_conv_form compressed -in privatekey.pem\n// Compressed Public Key ::\n// MFgwEAYHKoZIzj0CAQYFK4EEACMDRAADABeent7uNwvNWV/312BwUQI87LT1GuJC1+0RBn7MrJKxoqRAnMDansARh6yxaW5neOq9zaI53bfBu0CLPkBpz3v8`, `55627166021592560000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// secp521r1</span>\n\n<span class=\"token keyword\">const</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'node:crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> ecdh <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createECDH</span><span class=\"token punctuation\">(</span><span class=\"token string\">'secp521r1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\necdh<span class=\"token punctuation\">.</span><span class=\"token function\">generateKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> rawPrivate <span class=\"token operator\">=</span> ecdh<span class=\"token punctuation\">.</span><span class=\"token function\">getPrivateKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> rawPublic <span class=\"token operator\">=</span> ecdh<span class=\"token punctuation\">.</span><span class=\"token function\">getPublicKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'uncompressed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> privKey <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>rawPrivate<span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> pubKey <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>rawPublic<span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// uncompressed</span>\n<span class=\"token keyword\">const</span> privKeyHex <span class=\"token operator\">=</span> privKey<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Build the private key</span>\n<span class=\"token keyword\">const</span> privA <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">3081DC0201010442</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>privKeyHex<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'01'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">''</span> <span class=\"token operator\">:</span> <span class=\"token string\">'01'</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> privB <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'A00706052B81040023A1818903818600'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> privateKeyDer <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>privA<span class=\"token punctuation\">,</span> privKey<span class=\"token punctuation\">,</span> privB<span class=\"token punctuation\">,</span> pubKey<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Private Key ::'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>privateKeyDer<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Private Key ::</span>\n<span class=\"token comment\">// MIHcAgEBBEIBS++rLWx0TEghDwF+WM6t+16+t0dOXFwGiRR5D+ZFIFlTM4R92Y7isJEkh+sxgwsr6i9WfgKnhD9AyexaQQglkBygBwYFK4EEACOhgYkDgYYABAAXnp7e7jcLzVlf99dgcFECPOy09RriQtftEQZ+zKySsaKkQJzA2p7AEYessWluZ3jqvc2iOd23wbtAiz5Aac97/AE1BoNyj+ZOfMlnk1HN7TIAJfsViP75RSUOfnIXLMxh+6vmcOxsFg/2BrcSL9eVPEDRqPxX4cl9UmYQl3pz1CrTEw==</span>\n\n<span class=\"token comment\">// Build the public key</span>\n<span class=\"token keyword\">const</span> pubA <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'30819B301006072A8648CE3D020106052B8104002303818600'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> publicKeyDer <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>pubA<span class=\"token punctuation\">,</span> pubKey<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> rawCompressedPublic <span class=\"token operator\">=</span> ecdh<span class=\"token punctuation\">.</span><span class=\"token function\">getPublicKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'compressed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> compressedPubKey <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>rawCompressedPublic<span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// compressed</span>\n<span class=\"token keyword\">const</span> compressedPubA <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'3058301006072A8648CE3D020106052B81040023034400'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> compressedPublicKeyDer <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>compressedPubA<span class=\"token punctuation\">,</span> compressedPubKey<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Public Key ::'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>publicKeyDer<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Compressed Public Key ::'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>compressedPublicKeyDer<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// openssl pkey -pubout -in privatekey.pem</span>\n<span class=\"token comment\">// Public Key ::</span>\n<span class=\"token comment\">// MIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQAF56e3u43C81ZX/fXYHBRAjzstPUa4kLX7REGfsyskrGipECcwNqewBGHrLFpbmd46r3Nojndt8G7QIs+QGnPe/wBNQaDco/mTnzJZ5NRze0yACX7FYj++UUlDn5yFyzMYfur5nDsbBYP9ga3Ei/XlTxA0aj8V+HJfVJmEJd6c9Qq0xM=</span>\n\n<span class=\"token comment\">// openssl pkey -pubout -ec_conv_form compressed -in privatekey.pem</span>\n<span class=\"token comment\">// Compressed Public Key ::</span>\n<span class=\"token comment\">// MFgwEAYHKoZIzj0CAQYFK4EEACMDRAADABeent7uNwvNWV/312BwUQI87LT1GuJC1+0RBn7MrJKxoqRAnMDansARh6yxaW5neOq9zaI53bfBu0CLPkBpz3v8</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>You can use <a href=\"https://lapo.it/asn1js/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://lapo.it/asn1js/</a> to validate that the generated keys are valid EC key pairs with the appropriate curves.</p>","excerpt":"Some of my projects are leveraging the jsonwebtoken package to issue JWTs as access tokens to our users. The package itself requires private and public key pairs to be generated and accepts a few types of keys. One of them is an EC key pair with the","timeToRead":7,"frontmatter":{"date":"05 June, 2023","updatedAt":null,"slug":"generate-ec-private-public-key-pair-node","title":"Generate EC Private/Public Key Pair Natively in NodeJS","tags":["node","javascript","pki","jwt","security"],"featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAmUlEQVR42mMIwQ1CQ4EoLBRI4QAMeHQGBIZ4eXt4+fgBjSBBc1hYiLdvSF2Bc2uuqZudSRgOy7FoBioMDg4NDvLfNMXkynzPBcWGQYF+Idj0M+BwcHB3qUFhqsXMMuvuXGtPv7CwUGKdDQyloIhgJ3v38OY06/ggm8CQCKBrSAiwkJBwoBlhgR5BAd4hJAUYGASDcRg4ELADABhCn3D3ODH2AAAAAElFTkSuQmCC"},"backgroundColor":"transparent","images":{"fallback":{"src":"/static/c90c6706345b0205fc3c3369a8bfd8b3/6fc77/generate-ec-private-public-key-pair-node.png","srcSet":"/static/c90c6706345b0205fc3c3369a8bfd8b3/85ced/generate-ec-private-public-key-pair-node.png 800w,\n/static/c90c6706345b0205fc3c3369a8bfd8b3/7c498/generate-ec-private-public-key-pair-node.png 1080w,\n/static/c90c6706345b0205fc3c3369a8bfd8b3/6fc77/generate-ec-private-public-key-pair-node.png 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/c90c6706345b0205fc3c3369a8bfd8b3/28281/generate-ec-private-public-key-pair-node.webp 800w,\n/static/c90c6706345b0205fc3c3369a8bfd8b3/0b5d5/generate-ec-private-public-key-pair-node.webp 1080w,\n/static/c90c6706345b0205fc3c3369a8bfd8b3/a020d/generate-ec-private-public-key-pair-node.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":500}}}}},"comments":{"edges":[]}},"pageContext":{"slug":"generate-ec-private-public-key-pair-node"}},"staticQueryHashes":["3649515864","983108779"],"slicesMap":{}}
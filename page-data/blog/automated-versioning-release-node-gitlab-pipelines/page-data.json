{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blog/automated-versioning-release-node-gitlab-pipelines/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://zanechua.com"}},"posts":{"html":"<p>Versioning and releasing an application can be a time-consuming and complex process, especially when it involves tasks like determining the correct version to bump, adding appropriate tags, syncing the version back to different branches, and more.</p>\n<h1 id=\"Journey\" style=\"position:relative;\">Journey<a href=\"#Journey\" aria-label=\"Journey permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>In a small team, you tend to start automating a lot of work so that you can get more free time back and basically make a computer do the work for you. However, that also means that you need to provide relevant information to determine what version to bump to. We did not have a versioning strategy at the start, but now we're using a combination of packages to help us do so.</p>\n<p>For example, if you added a breaking change, is your application following semantic versioning? If so you should bump the major version. How about when you should bump a minor or patch version or what if you're not on semantic versioning, what would your versioning strategy be then?</p>\n<p>The process we had initially was to make use of <a href=\"https://www.conventionalcommits.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">conventional commits</a> coupled together with <a href=\"https://github.com/conventional-changelog/standard-version\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">standard-version</a> to bump up our project version. That worked well, but it was a bit lacking as we had to run the release command everytime, made sure we synced the changes back to the develop (Admittedly some of us forgot to do this) branch and create a release for this in GitLab. When you're doing this many rapid releases multiple times in a week, this whole process can be quite a chore to do.</p>\n<p>Automation to the rescue! The other challenge that we faced was how do we ensure our engineers adhere to the conventional commit standard? We combined <a href=\"https://github.com/commitizen/cz-cli\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">commitizen</a> which is essentially a command line helper tool to create a commit along with <a href=\"https://github.com/commitizen/cz-conventional-changelog\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">cz-conventional-changelog</a>.</p>\n<p>However, that only enforces the convention if they actually use the <code class=\"language-text\">cz</code> command. How would we enforce it if they use the <code class=\"language-text\">git</code> command directly? With a combination of <a href=\"https://github.com/typicode/husky\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">husky</a> , <a href=\"https://github.com/conventional-changelog/commitlint\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@commitlint/cli</a> and <a href=\"https://github.com/conventional-changelog/commitlint\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@commitlint/config-conventional</a>. <code class=\"language-text\">husky</code> is a popular package that allows you to execute code in a certain lifecycle stage in <code class=\"language-text\">git</code>. It leverages <code class=\"language-text\">git</code> hooks and bootstraps the necessary hooks when someone sets up the project repository in their environment. The packages under the <code class=\"language-text\">@commitlint</code> umbrella help us enforce that the conventional commit standard is being adhered to.</p>\n<p>Let's get onto the actual code now that we've talked about the problem statement.</p>\n<h1 id=\"Solve\" style=\"position:relative;\">Solve<a href=\"#Solve\" aria-label=\"Solve permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>At this point, I am going to assume that you already have a basic CI/CD pipeline within GitLab itself, so let's do some abstraction of the jobs so that we don't have to maintain such a large <code class=\"language-text\">.gitlab-ci.yml</code> file.</p>\n<h2 id=\"Setting-up-the-pipeline-templates\" style=\"position:relative;\">Setting up the pipeline templates<a href=\"#Setting-up-the-pipeline-templates\" aria-label=\"Setting up the pipeline templates permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The following is a <code class=\"language-text\">.base.yml</code> that can act as a base template for all your repositories, let's not make it more complicated now and assume that this will be stored in the same repository as your code.</p>\n<p>I've shown this code before in another <a href=\"/blog/lint-and-format-code-node-gitlab-pipelines\">post</a> about linting and formatting code in a GitLab pipeline.</p>\n<p>The following code sets up the <code class=\"language-text\">ssh</code> environment in the job to make sure that it is able to connect over <code class=\"language-text\">ssh</code> to push changes. Running the <code class=\"language-text\">ssh</code> command on your local machine when you're connecting to a host for the first time would result in you having to \"verify\" if you are connecting to the correct host.</p>\n<p>This also assumes that you have a bot account or equivalent and is using an SSH key stored in a variable named <code class=\"language-text\">CI_SSH_PRIVATE_KEY</code> at a group or project level. There are other ways around it like using project or group access tokens.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">/templates/.base.yml</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"8256999932103248000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`.git_setup:\n  before_script:\n    ##\n    ## Install ssh-agent if not already installed, it is required by Docker.\n    ## (change apt-get to yum if you use an RPM-based image)\n    ##\n    - 'which ssh-agent || ( apk --update add git openssh-client )'\n\n    ##\n    ## Run ssh-agent (inside the build environment)\n    ##\n    - eval &quot;\\$(ssh-agent -s)&quot;\n\n    ##\n    ## Add the SSH key stored in SSH_PRIVATE_KEY variable to the agent store\n    ## We're using tr to fix line endings which makes ed25519 keys work\n    ## without extra base64 encoding.\n    ## https://gitlab.com/gitlab-examples/ssh-private-key/issues/1#note_48526556\n    ##\n    - echo &quot;\\$CI_SSH_PRIVATE_KEY&quot; | tr -d '\\r' | ssh-add -\n\n    ##\n    ## Create the SSH directory and give it the right permissions\n    ##\n    - mkdir -p ~/.ssh\n    - chmod 700 ~/.ssh\n\n    ##\n    ## Alternatively, use ssh-keyscan to scan the keys of your private server.\n    ## Replace example.com with your private server's domain name. Repeat that\n    ## command if you have more than one server to connect to.\n    ##\n    - touch ~/.ssh/known_hosts\n    - ssh-keyscan \\$CI_SERVER_HOST >> ~/.ssh/known_hosts\n    - chmod 644 ~/.ssh/known_hosts\n\n    ##\n    ## Optionally, if you will be using any Git commands, set the user name and\n    ## and email.\n    ##\n    - git config --global user.email &quot;bot@example.com&quot;\n    - git config --global user.name &quot;Magical CI Bot&quot;`, `8256999932103248000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">.git_setup</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\">##</span>\n    <span class=\"token comment\">## Install ssh-agent if not already installed, it is required by Docker.</span>\n    <span class=\"token comment\">## (change apt-get to yum if you use an RPM-based image)</span>\n    <span class=\"token comment\">##</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">'which ssh-agent || ( apk --update add git openssh-client )'</span>\n\n    <span class=\"token comment\">##</span>\n    <span class=\"token comment\">## Run ssh-agent (inside the build environment)</span>\n    <span class=\"token comment\">##</span>\n    <span class=\"token punctuation\">-</span> eval \"$(ssh<span class=\"token punctuation\">-</span>agent <span class=\"token punctuation\">-</span>s)\"\n\n    <span class=\"token comment\">##</span>\n    <span class=\"token comment\">## Add the SSH key stored in SSH_PRIVATE_KEY variable to the agent store</span>\n    <span class=\"token comment\">## We're using tr to fix line endings which makes ed25519 keys work</span>\n    <span class=\"token comment\">## without extra base64 encoding.</span>\n    <span class=\"token comment\">## https://gitlab.com/gitlab-examples/ssh-private-key/issues/1#note_48526556</span>\n    <span class=\"token comment\">##</span>\n    <span class=\"token punctuation\">-</span> echo \"$CI_SSH_PRIVATE_KEY\" <span class=\"token punctuation\">|</span> tr <span class=\"token punctuation\">-</span>d '\\r' <span class=\"token punctuation\">|</span> ssh<span class=\"token punctuation\">-</span>add <span class=\"token punctuation\">-</span>\n\n    <span class=\"token comment\">##</span>\n    <span class=\"token comment\">## Create the SSH directory and give it the right permissions</span>\n    <span class=\"token comment\">##</span>\n    <span class=\"token punctuation\">-</span> mkdir <span class=\"token punctuation\">-</span>p ~/.ssh\n    <span class=\"token punctuation\">-</span> chmod 700 ~/.ssh\n\n    <span class=\"token comment\">##</span>\n    <span class=\"token comment\">## Alternatively, use ssh-keyscan to scan the keys of your private server.</span>\n    <span class=\"token comment\">## Replace example.com with your private server's domain name. Repeat that</span>\n    <span class=\"token comment\">## command if you have more than one server to connect to.</span>\n    <span class=\"token comment\">##</span>\n    <span class=\"token punctuation\">-</span> touch ~/.ssh/known_hosts\n    <span class=\"token punctuation\">-</span> ssh<span class=\"token punctuation\">-</span>keyscan $CI_SERVER_HOST <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> ~/.ssh/known_hosts\n    <span class=\"token punctuation\">-</span> chmod 644 ~/.ssh/known_hosts\n\n    <span class=\"token comment\">##</span>\n    <span class=\"token comment\">## Optionally, if you will be using any Git commands, set the user name and</span>\n    <span class=\"token comment\">## and email.</span>\n    <span class=\"token comment\">##</span>\n    <span class=\"token punctuation\">-</span> git config <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>global user.email \"bot@example.com\"\n    <span class=\"token punctuation\">-</span> git config <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>global user.name \"Magical CI Bot\"</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here's the release job, the <code class=\"language-text\">script</code> section does the following:</p>\n<ol>\n<li>Configures the remote and pulls the current commit branch</li>\n<li>Sets the current commit message as a variable <code class=\"language-text\">SUBJECT_COMMIT_MESSAGE</code></li>\n<li>Sets the default merge commit message format as a variable <code class=\"language-text\">MERGE_COMMIT_MESSAGE</code> for the trigger and target branches</li>\n<li>Checks if the <code class=\"language-text\">SUBJECT_COMMIT_MESSAGE</code> variable matches the <code class=\"language-text\">MERGE_COMMIT_MESSAGE</code> variable</li>\n<li>If it doesn't, it'll simply exit the job cleanly</li>\n<li>Otherwise, it will install all packages required for the release command</li>\n<li>Release command is executed which results in a new commit being added to the HEAD</li>\n<li>We push the commit to the current branch we're on</li>\n<li>We set the <code class=\"language-text\">SKIP_SYNC_STAGE</code> variable so that the sync job runs</li>\n<li>The artifacts will pass the variables that have been stored in <code class=\"language-text\">build.env</code> to another job that depends on this job</li>\n</ol>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">/templates/release/.base.yml</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"45107310709304270000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`include:\n  - local: '/templates/.base.yml'\n\nrelease_job:\n  stage: release\n  cache:\n    - key:\n        files:\n          - yarn.lock\n      paths:\n        - node_modules/\n        - .yarn/\n      policy: pull\n  before_script:\n    - !reference [.git_setup, before_script]\n  script:\n    - git remote set-url origin git@\\$CI_SERVER_HOST:\\$CI_PROJECT_PATH.git\n    - git fetch\n    - git checkout -B \\$CI_COMMIT_BRANCH\n    - SUBJECT_COMMIT_MESSAGE=\\$(git log -1 --pretty=%s)\n    - echo \\$SUBJECT_COMMIT_MESSAGE\n    - MERGE_COMMIT_MESSAGE=&quot;Merge branch '\\$RELEASE_TRIGGER_BRANCH' into '\\$RELEASE_TARGET_BRANCH'&quot;\n    - |\n      if [ &quot;\\$SUBJECT_COMMIT_MESSAGE&quot; != &quot;\\$MERGE_COMMIT_MESSAGE&quot; ] ; then\n          echo &quot;Release is not required. Skipping this job!&quot;\n          echo &quot;SKIP_SYNC_STAGE=true&quot; > build.env\n          echo &quot;CI_JOB_SKIP_EXIT_CODE=20&quot; > build.env\n          exit \\${CI_JOB_SKIP_EXIT_CODE:-0}\n      fi\n    - yarn install --frozen-lockfile --prefer-offline --cache-folder .yarn\n    - echo &quot;Running release&quot;\n    - yarn release || true\n    - git push --follow-tags -u origin \\$CI_COMMIT_BRANCH\n    - echo &quot;SKIP_SYNC_STAGE=false&quot; > build.env # Run sync stage\n    - echo &quot;CI_JOB_SKIP_EXIT_CODE=20&quot; >> build.env # Arbitrary exit code so that future jobs fail and don't waste runner resources\n  artifacts:\n    reports:\n      dotenv: build.env`, `45107310709304270000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">include</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'/templates/.base.yml'</span>\n\n<span class=\"token key atrule\">release_job</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> release\n  <span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">files</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> yarn.lock\n      <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> node_modules/\n        <span class=\"token punctuation\">-</span> .yarn/\n      <span class=\"token key atrule\">policy</span><span class=\"token punctuation\">:</span> pull\n  <span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token tag\">!reference</span> <span class=\"token punctuation\">[</span>.git_setup<span class=\"token punctuation\">,</span> before_script<span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> git remote set<span class=\"token punctuation\">-</span>url origin git@$CI_SERVER_HOST<span class=\"token punctuation\">:</span>$CI_PROJECT_PATH.git\n    <span class=\"token punctuation\">-</span> git fetch\n    <span class=\"token punctuation\">-</span> git checkout <span class=\"token punctuation\">-</span>B $CI_COMMIT_BRANCH\n    <span class=\"token punctuation\">-</span> SUBJECT_COMMIT_MESSAGE=$(git log <span class=\"token punctuation\">-</span>1 <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>pretty=%s)\n    <span class=\"token punctuation\">-</span> echo $SUBJECT_COMMIT_MESSAGE\n    <span class=\"token punctuation\">-</span> MERGE_COMMIT_MESSAGE=\"Merge branch '$RELEASE_TRIGGER_BRANCH' into '$RELEASE_TARGET_BRANCH'\"\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n      if [ \"$SUBJECT_COMMIT_MESSAGE\" != \"$MERGE_COMMIT_MESSAGE\" ] ; then\n          echo \"Release is not required. Skipping this job!\"\n          echo \"SKIP_SYNC_STAGE=true\" > build.env\n          echo \"CI_JOB_SKIP_EXIT_CODE=20\" > build.env\n          exit ${CI_JOB_SKIP_EXIT_CODE:-0}\n      fi</span>\n    <span class=\"token punctuation\">-</span> yarn install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>frozen<span class=\"token punctuation\">-</span>lockfile <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>prefer<span class=\"token punctuation\">-</span>offline <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>cache<span class=\"token punctuation\">-</span>folder .yarn\n    <span class=\"token punctuation\">-</span> echo \"Running release\"\n    <span class=\"token punctuation\">-</span> yarn release <span class=\"token punctuation\">|</span><span class=\"token punctuation\">|</span> true\n    <span class=\"token punctuation\">-</span> git push <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>follow<span class=\"token punctuation\">-</span>tags <span class=\"token punctuation\">-</span>u origin $CI_COMMIT_BRANCH\n    <span class=\"token punctuation\">-</span> echo \"SKIP_SYNC_STAGE=false\" <span class=\"token punctuation\">></span> build.env <span class=\"token comment\"># Run sync stage</span>\n    <span class=\"token punctuation\">-</span> echo \"CI_JOB_SKIP_EXIT_CODE=20\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> build.env <span class=\"token comment\"># Arbitrary exit code so that future jobs fail and don't waste runner resources</span>\n  <span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">reports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dotenv</span><span class=\"token punctuation\">:</span> build.env</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here's the snasphot job, which basically just leverages on the <code class=\"language-text\">release-cli</code> image provided by GitLab to create a release in your project.</p>\n<p>It uses the <code class=\"language-text\">CI_COMMIT_TAG</code> variable as the name and tag for the project coupled with the <code class=\"language-text\">CHANGELOG-LATEST.md</code> for the release description. This job will only run on a <code class=\"language-text\">tag</code> pipeline.</p>\n<p>You can identify a particular type of pipeline by looking at the <code class=\"language-text\">Pipelines</code> section of your project and looking out for the symbol beside the sha hash or tag.</p>\n<p>A tag pipeline will look like the following:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 410px; margin: 0.7rem 0; margin-left: 0!important; margin-right: 0!important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7f63d67355a2d3c2c2e3e3e766ca5cbd/d68e4/01-tag-pipeline.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.499999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABFElEQVR42m2Qy07CUBRF+Q0f7e2Dvm4pXNFSgUJKhcQomkCMOmHAV+jA39JIHJA4I37U8kITEqKDnZOcnLOy967ZXoDl+JXcACE8hFn/o8CPicImcaywRJ3FYsl6/c3H+yfF8IrjI6H3HjV/cIGVJlidBDtr7cDCOISZhktRTLidzpnezZiU17y+vLHZ/LBaffEwf8Q4dStg1G4TKoXfbCH8AMN0/3Uos3tkd0aSP5EMn4nSG7JsQJ6XdLOcTtqj0TijNuyP6WUF/csRjUjh1eXO0R6m45knDqJMiZZjrNE5tiWx7FC7cnY3rhPonV85DIMEKRWxbKFUhtTQA+BWugLD1+CmTuDpqUGm4ezr2Matflx+AYzQnQCnNugLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Tag Pipeline\"\n        title=\"\"\n        src=\"/static/7f63d67355a2d3c2c2e3e3e766ca5cbd/d68e4/01-tag-pipeline.png\"\n        srcset=\"/static/7f63d67355a2d3c2c2e3e3e766ca5cbd/772e8/01-tag-pipeline.png 200w,\n/static/7f63d67355a2d3c2c2e3e3e766ca5cbd/e17e5/01-tag-pipeline.png 400w,\n/static/7f63d67355a2d3c2c2e3e3e766ca5cbd/d68e4/01-tag-pipeline.png 410w\"\n        sizes=\"(max-width: 410px) 100vw, 410px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">/templates/release/.snapshot.yml</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"79808123879404130000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`snapshot_job:\n  stage: release\n  image: registry.gitlab.com/gitlab-org/release-cli:latest\n  rules:\n    - if: \\$CI_COMMIT_TAG # Run this job when a tag is created\n  script:\n    - echo &quot;Creating release for \\$CI_PROJECT_NAME on \\$CI_SERVER_HOST&quot;\n  needs:\n    - job: lint_job\n      artifacts: true\n  release:\n    name: \\$CI_COMMIT_TAG\n    tag_name: \\$CI_COMMIT_TAG\n    description: './CHANGELOG-LATEST.md'`, `79808123879404130000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">snapshot_job</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> release\n  <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> registry.gitlab.com/gitlab<span class=\"token punctuation\">-</span>org/release<span class=\"token punctuation\">-</span>cli<span class=\"token punctuation\">:</span>latest\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_COMMIT_TAG <span class=\"token comment\"># Run this job when a tag is created</span>\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> echo \"Creating release for $CI_PROJECT_NAME on $CI_SERVER_HOST\"\n  <span class=\"token key atrule\">needs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job</span><span class=\"token punctuation\">:</span> lint_job\n      <span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> $CI_COMMIT_TAG\n    <span class=\"token key atrule\">tag_name</span><span class=\"token punctuation\">:</span> $CI_COMMIT_TAG\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'./CHANGELOG-LATEST.md'</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Here's the sync job and I know it's a bit pointless for the job to be running only for it to check an external variable to control the pipeline execution, however there is no other way to dynamically control job executions based on a previous job's output at the moment due to the deterministic nature of GitLab which generates out the schema or the proper term being a DAG (Directed Acyclic Graph) of the pipeline before executing it.</p>\n<p>The <code class=\"language-text\">script</code> section does the following:</p>\n<ol>\n<li>It checks if the <code class=\"language-text\">SKIP_SYNC_STAGE</code> is <code class=\"language-text\">true</code> and exits cleanly if so</li>\n<li>Otherwise, it will setup the remote and fetch all the commits</li>\n<li>The <code class=\"language-text\">SYNC_TARGET_BRANCH</code> will be checked out</li>\n<li>We will reset hard to the <code class=\"language-text\">CI_COMMIT_BRANCH</code></li>\n<li>We will push the changes to the <code class=\"language-text\">SYNC_TARGET_BRANCH</code></li>\n</ol>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">/templates/sync/.base.yml</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"78733712002617210000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`include:\n  - local: '/templates/.base.yml'\n\n.sync_job:\n  stage: sync\n  cache: {}\n  before_script:\n    - !reference [.git_setup, before_script]\n  script:\n    - echo &quot;Sync Stage&quot;\n    - |\n      if [ &quot;SKIP_SYNC_STAGE&quot; == &quot;true&quot; ] ; then\n          echo &quot;Skipping stage due to variable&quot;\n          exit \\${CI_JOB_SKIP_EXIT_CODE:-0}\n      fi\n    - git remote set-url origin git@\\$CI_SERVER_HOST:\\$CI_PROJECT_PATH.git\n    - git fetch\n    - git checkout -B \\$SYNC_TARGET_BRANCH\n    - git reset --hard origin/\\$CI_COMMIT_BRANCH\n    - git push -u origin \\$SYNC_TARGET_BRANCH`, `78733712002617210000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">include</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'/templates/.base.yml'</span>\n\n<span class=\"token key atrule\">.sync_job</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> sync\n  <span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token tag\">!reference</span> <span class=\"token punctuation\">[</span>.git_setup<span class=\"token punctuation\">,</span> before_script<span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> echo \"Sync Stage\"\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n      if [ \"SKIP_SYNC_STAGE\" == \"true\" ] ; then\n          echo \"Skipping stage due to variable\"\n          exit ${CI_JOB_SKIP_EXIT_CODE:-0}\n      fi</span>\n    <span class=\"token punctuation\">-</span> git remote set<span class=\"token punctuation\">-</span>url origin git@$CI_SERVER_HOST<span class=\"token punctuation\">:</span>$CI_PROJECT_PATH.git\n    <span class=\"token punctuation\">-</span> git fetch\n    <span class=\"token punctuation\">-</span> git checkout <span class=\"token punctuation\">-</span>B $SYNC_TARGET_BRANCH\n    <span class=\"token punctuation\">-</span> git reset <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>hard origin/$CI_COMMIT_BRANCH\n    <span class=\"token punctuation\">-</span> git push <span class=\"token punctuation\">-</span>u origin $SYNC_TARGET_BRANCH</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"Project-modifications\" style=\"position:relative;\">Project modifications<a href=\"#Project-modifications\" aria-label=\"Project modifications permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>We'll need to make some modifications to your project so that it supports the various packages that I've listed above.</p>\n<blockquote>\n<p>You can make these changes for projects in any language to enable the ability to do so. But my post does favour Node based applications, you will have to set up some additional configuration to target the files that contain the versioning for that framework or language</p>\n</blockquote>\n<p>Let's install the packages either via <code class=\"language-text\">yarn</code> or <code class=\"language-text\">npm</code>, I will be using <code class=\"language-text\">yarn</code> in all the subsequent examples so please modify as needed.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">terminal</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"30310405616218673000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`yarn add --dev husky @commitlint/cli @commitlint/config-conventional standard-version cz-conventional-changelog rexreplace`, `30310405616218673000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> <span class=\"token parameter variable\">--dev</span> husky @commitlint/cli @commitlint/config-conventional standard-version cz-conventional-changelog rexreplace</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>or</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">terminal</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"95706712395906380000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`npm install --dev husky @commitlint/cli @commitlint/config-conventional standard-version cz-conventional-changelog rexreplace`, `95706712395906380000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">--dev</span> husky @commitlint/cli @commitlint/config-conventional standard-version cz-conventional-changelog rexreplace</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Follow the instructions in the documentation of the various packages on how to set them up. I will not go through what each of these modifications do as the functionalities should be well documented in the source repositories themselves.</p>\n<p>The only one addition is the <code class=\"language-text\">changelog:latest</code> script that leverages on the <code class=\"language-text\">rexreplace</code> package. This extracts out the latest release information from the <code class=\"language-text\">CHANGELOG.md</code> file to be utilized by the snapshot job as the release description on GitLab.</p>\n<p>In summary, you should have the following snippets of code present in these files:</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">package.json</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"38331149273025830000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`...\n  &quot;scripts&quot;: {\n    ...\n    &quot;release&quot;: &quot;standard-version&quot;,\n    &quot;prepare&quot;: &quot;husky install&quot;,\n    &quot;changelog:latest&quot;: &quot;rexreplace \\&quot;^.*?#+\\\\s\\\\[.*?\\\\n.*?(?=\\\\s*#+\\\\s\\\\[)\\&quot; \\&quot;_\\&quot; -s -M -G -m -o \\&quot;CHANGELOG.md\\&quot; > CHANGELOG-LATEST.md&quot;\n  },\n  &quot;config&quot;: {\n    &quot;commitizen&quot;: {\n      &quot;path&quot;: &quot;./node_modules/cz-conventional-changelog&quot;\n    }\n  }`, `38331149273025830000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\">...\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    ...\n    <span class=\"token property\">\"release\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"standard-version\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"prepare\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"husky install\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"changelog:latest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rexreplace \\\"^.*?#+\\\\s\\\\[.*?\\\\n.*?(?=\\\\s*#+\\\\s\\\\[)\\\" \\\"_\\\" -s -M -G -m -o \\\"CHANGELOG.md\\\" > CHANGELOG-LATEST.md\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"config\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"commitizen\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/cz-conventional-changelog\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">.commitlintrc.json</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"46022914487402120000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`{\n  &quot;extends&quot;: [&quot;@commitlint/config-conventional&quot;]\n}`, `46022914487402120000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@commitlint/config-conventional\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">.versionrc.json</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"30170456823118120000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`{\n  &quot;header&quot;: &quot;# Changelog\\n&quot;,\n  &quot;types&quot;: [\n    {&quot;type&quot;: &quot;feat&quot;, &quot;section&quot;: &quot;Features&quot;},\n    {&quot;type&quot;: &quot;fix&quot;, &quot;section&quot;: &quot;Bug Fixes&quot;},\n    {&quot;type&quot;: &quot;chore&quot;, &quot;section&quot;: &quot;Maintenance&quot;},\n    {&quot;type&quot;: &quot;docs&quot;, &quot;hidden&quot;: true},\n    {&quot;type&quot;: &quot;style&quot;, &quot;hidden&quot;: true},\n    {&quot;type&quot;: &quot;refactor&quot;, &quot;hidden&quot;: true},\n    {&quot;type&quot;: &quot;perf&quot;, &quot;hidden&quot;: true},\n    {&quot;type&quot;: &quot;test&quot;, &quot;hidden&quot;: true}\n  ]\n}`, `30170456823118120000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"header\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"# Changelog\\n\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"types\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span><span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"feat\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"section\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Features\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fix\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"section\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bug Fixes\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"chore\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"section\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Maintenance\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"docs\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"hidden\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"style\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"hidden\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"refactor\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"hidden\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"perf\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"hidden\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"hidden\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">.husky/commit-msg</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"67800540732570070000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`#!/bin/sh\n. &quot;\\$(dirname &quot;\\$0&quot;)/_/husky.sh&quot;\n\nyarn commitlint --edit \\${1}`, `67800540732570070000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n<span class=\"token builtin class-name\">.</span> <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">dirname</span> <span class=\"token string\">\"<span class=\"token variable\">$0</span>\"</span><span class=\"token variable\">)</span></span>/_/husky.sh\"</span>\n\n<span class=\"token function\">yarn</span> commitlint <span class=\"token parameter variable\">--edit</span> <span class=\"token variable\">${1}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"Putting-it-all-together\" style=\"position:relative;\">Putting it all together<a href=\"#Putting-it-all-together\" aria-label=\"Putting it all together permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>So now that we've got all the templates and project modifications sorted, let's build the actual <code class=\"language-text\">.gitlab-ci.yml</code>.</p>\n<p>In the <code class=\"language-text\">.gitlab-ci.yml</code> file below, I am doing the following:</p>\n<ol>\n<li>Including all the template files that I have defined above</li>\n<li>Defining a <code class=\"language-text\">clean</code>, <code class=\"language-text\">release</code> and <code class=\"language-text\">sync</code> stage in addition to the rest of the stages that have been previously defined</li>\n<li>Define a <code class=\"language-text\">lint_job</code> that runs only on a tag pipeline that generates out the latest changelog for the <code class=\"language-text\">snapshot_job</code></li>\n<li>Define a <code class=\"language-text\">release_job</code> that only runs on the <code class=\"language-text\">master</code> branch and when the commit message starts with <code class=\"language-text\">Merge branch</code>, the <code class=\"language-text\">RELEASE_TRIGGER_BRANCH</code> and <code class=\"language-text\">RELEASE_TARGET_BRANCH</code> variables makes sure that the direction of merge is from trigger to the target</li>\n<li>Define a <code class=\"language-text\">sync_develop</code> job that only runs on the <code class=\"language-text\">master</code> branch and when the commit message starts with <code class=\"language-text\">Merge branch</code>, syncing the code from the current pipeline branch to the <code class=\"language-text\">develop</code> branch as defined by the <code class=\"language-text\">SYNC_TARGET_BRANCH</code> variable. It also sets an additional condition that the job requires the <code class=\"language-text\">release_job</code> to be completed and needs access to its artifacts. The reason why we need artifacts here is to access the variables that I outputted to <code class=\"language-text\">build.env</code></li>\n</ol>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">.gitlab-ci.yml</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"99740733205390930000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`include:\n  - local: '/templates/.base.yml'\n  - local: '/templates/release/.base.yml'\n  - local: '/templates/release/.snapshot.yml'\n  - local: '/templates/sync/.base.yml'\n\nstages:\n  - clean\n  ...\n  - release\n  - sync\n\nlint_job:\n  rules:\n    - if: \\$CI_COMMIT_TAG # Run this job when a tag is created\n  script:\n    - echo &quot;Generating latest changelog for \\$CI_PROJECT_NAME&quot;\n    - yarn run changelog:latest\n  artifacts:\n    expire_in: 1 hour\n    paths:\n      - CHANGELOG-LATEST.md\n\nrelease_job:\n  rules:\n    - if: \\$CI_COMMIT_BRANCH == &quot;master&quot; && \\$CI_COMMIT_TITLE =~ /Merge branch.*/\n  variables:\n    RELEASE_TRIGGER_BRANCH: develop\n    RELEASE_TARGET_BRANCH: master\n\nsync_develop:\n  rules:\n    - if: \\$CI_COMMIT_BRANCH == &quot;master&quot; && \\$CI_COMMIT_TITLE =~ /Merge branch.*/\n  variables:\n    SYNC_TARGET_BRANCH: develop\n  needs:\n    - job: release_job\n      artifacts: true\n  extends: .sync_job`, `99740733205390930000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">include</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'/templates/.base.yml'</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'/templates/release/.base.yml'</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'/templates/release/.snapshot.yml'</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'/templates/sync/.base.yml'</span>\n\n<span class=\"token key atrule\">stages</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> clean\n  <span class=\"token punctuation\">...</span>\n  <span class=\"token punctuation\">-</span> release\n  <span class=\"token punctuation\">-</span> sync\n\n<span class=\"token key atrule\">lint_job</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_COMMIT_TAG <span class=\"token comment\"># Run this job when a tag is created</span>\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> echo \"Generating latest changelog for $CI_PROJECT_NAME\"\n    <span class=\"token punctuation\">-</span> yarn run changelog<span class=\"token punctuation\">:</span>latest\n  <span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">expire_in</span><span class=\"token punctuation\">:</span> 1 hour\n    <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> CHANGELOG<span class=\"token punctuation\">-</span>LATEST.md\n\n<span class=\"token key atrule\">release_job</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_COMMIT_BRANCH == \"master\" <span class=\"token important\">&amp;&amp;</span> $CI_COMMIT_TITLE =~ /Merge branch.<span class=\"token important\">*/</span>\n  <span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">RELEASE_TRIGGER_BRANCH</span><span class=\"token punctuation\">:</span> develop\n    <span class=\"token key atrule\">RELEASE_TARGET_BRANCH</span><span class=\"token punctuation\">:</span> master\n\n<span class=\"token key atrule\">sync_develop</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_COMMIT_BRANCH == \"master\" <span class=\"token important\">&amp;&amp;</span> $CI_COMMIT_TITLE =~ /Merge branch.<span class=\"token important\">*/</span>\n  <span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">SYNC_TARGET_BRANCH</span><span class=\"token punctuation\">:</span> develop\n  <span class=\"token key atrule\">needs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job</span><span class=\"token punctuation\">:</span> release_job\n      <span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">extends</span><span class=\"token punctuation\">:</span> .sync_job</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"Hol-up-One-second-Where-is-the-snapshot-job\" style=\"position:relative;\">Hol up.. One second. Where is the snapshot job?<a href=\"#Hol-up-One-second-Where-is-the-snapshot-job\" aria-label=\"Hol up One second Where is the snapshot job permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The <code class=\"language-text\">snapshot_job</code> is defined in the template itself and as long as you include the template, and you don't need to modify any of the job properties, the job will automatically get added into the pipeline as long as the conditions (Set to run in tag pipelines only) are fulfilled.</p>\n<h3 id=\"Why-are-you-using-extends-for-the-sync-jobs\" style=\"position:relative;\">Why are you using <code class=\"language-text\">extends</code> for the sync jobs?<a href=\"#Why-are-you-using-extends-for-the-sync-jobs\" aria-label=\"Why are you using extends for the sync jobs permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>The reason we're using <code class=\"language-text\">extends</code> is because we've defined it as a template to be used instead of an actual job. Notice the addition of a <code class=\"language-text\">.</code> inplace of a job name?</p>\n<p>Other reasons include wanting to update more than one branch at time. For example perhaps you have a situation where you want to update multiple branches to the latest release. If we had defined the code as a job, you would not be able to easily reuse the template over and over again.</p>\n<p>Here's an example where you can see that I am syncing the master branch to two separate branches.</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">.gitlab-alt.ci.yml</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"75082809615146160000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`...\nsync_develop:\n  rules:\n    - if: \\$CI_COMMIT_BRANCH == &quot;master&quot; && \\$CI_COMMIT_TITLE =~ /Merge branch.*/\n  variables:\n    SYNC_TARGET_BRANCH: develop\n  needs:\n    - job: release_job\n      artifacts: true\n  extends: .sync_job\n\nsync_deployment:\n  rules:\n    - if: \\$CI_COMMIT_BRANCH == &quot;master&quot; && \\$CI_COMMIT_TITLE =~ /Merge branch.*/\n  variables:\n    SYNC_TARGET_BRANCH: deployment\n  needs:\n    - job: release_job\n      artifacts: true\n  extends: .sync_job`, `75082809615146160000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token punctuation\">...</span>\n<span class=\"token key atrule\">sync_develop</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_COMMIT_BRANCH == \"master\" <span class=\"token important\">&amp;&amp;</span> $CI_COMMIT_TITLE =~ /Merge branch.<span class=\"token important\">*/</span>\n  <span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">SYNC_TARGET_BRANCH</span><span class=\"token punctuation\">:</span> develop\n  <span class=\"token key atrule\">needs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job</span><span class=\"token punctuation\">:</span> release_job\n      <span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">extends</span><span class=\"token punctuation\">:</span> .sync_job\n\n<span class=\"token key atrule\">sync_deployment</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $CI_COMMIT_BRANCH == \"master\" <span class=\"token important\">&amp;&amp;</span> $CI_COMMIT_TITLE =~ /Merge branch.<span class=\"token important\">*/</span>\n  <span class=\"token key atrule\">variables</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">SYNC_TARGET_BRANCH</span><span class=\"token punctuation\">:</span> deployment\n  <span class=\"token key atrule\">needs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job</span><span class=\"token punctuation\">:</span> release_job\n      <span class=\"token key atrule\">artifacts</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">extends</span><span class=\"token punctuation\">:</span> .sync_job</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If it all goes as planned, you will first have a pipeline run for the merge commit</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 668px; margin: 0.7rem 0; margin-left: 0!important; margin-right: 0!important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/87b1a06e8446abd70d89a519974d85db/74866/02-pipeline-for-merge-commit.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2klEQVR42j2PW07EMBRDu5A2yc07mdApFY+2wxQJipD4gSWwEZbDOs1NK/FxZEWO47hR5KE0oxjpdkg5pHBC8hmhEgprgWcik/ishGUM2pYgWInzxd2g8Q8j9F0P6TxkZw+TAp63T6zbF+and6zXV2zbB+bpiml5wXx5g/UDOl2w9AuyOcGqgN/vHzTTtOJ2eIS3GZJbD/inbgTFe5AboLkgxzMMq6IMQQWGH1TujD6M8BQhOoOkMxqjI6xJsDbxXPs/W3WaoX1WLakBuXvHVFn9OplViCPX8p0/+rp1vS3GTIkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Pipeline for merge commit\"\n        title=\"\"\n        src=\"/static/87b1a06e8446abd70d89a519974d85db/74866/02-pipeline-for-merge-commit.png\"\n        srcset=\"/static/87b1a06e8446abd70d89a519974d85db/772e8/02-pipeline-for-merge-commit.png 200w,\n/static/87b1a06e8446abd70d89a519974d85db/e17e5/02-pipeline-for-merge-commit.png 400w,\n/static/87b1a06e8446abd70d89a519974d85db/74866/02-pipeline-for-merge-commit.png 668w\"\n        sizes=\"(max-width: 668px) 100vw, 668px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Which should contain the following jobs</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 486px; margin: 0.7rem 0; margin-left: 0!important; margin-right: 0!important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e9e419006e6187e1dd4fa3626e19df80/4ee7f/03-pipeline-for-merge-commit-jobs.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNklEQVR42oVS2XKDMAzkO8LhHJCLpkkgxmAgGEKOdtr//5ytbBJyzLR92LHHWq1Wki3mTeAMhrDtEZjn/wqX4q4z/pOjYY3HCyjVoioPGA2nGLKgD5o78+GQGOcSCc/huRPzfsMTVwsyL0A4X2MxfzeJGrckfWqSPufTFWZBaOLa6Z3r91wNyw+WWGUCaVpiTy7LsiEnEnGUgu9kV52SlrsYscxRyJp4DVR1NHztOtoKiKQwHVrBLMS2KlDXZ5xPXzi2n5DZHrs4M8KmFRIMOYcoK6h9i1qd0DYXw81lheha3Agy3ZbTzckeMMJ9+P0StMMoRiQkBC8gRAkpFaJNgnC5NQ51R53gw1BfB93HSPAtTSCUwoE6acjdx+UbRa6wWXPjLqUiT4L/wu3gXBdi01d73PiN9wNB8uyozbqKgAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Pipeline for merge commit jobs\"\n        title=\"\"\n        src=\"/static/e9e419006e6187e1dd4fa3626e19df80/4ee7f/03-pipeline-for-merge-commit-jobs.png\"\n        srcset=\"/static/e9e419006e6187e1dd4fa3626e19df80/772e8/03-pipeline-for-merge-commit-jobs.png 200w,\n/static/e9e419006e6187e1dd4fa3626e19df80/e17e5/03-pipeline-for-merge-commit-jobs.png 400w,\n/static/e9e419006e6187e1dd4fa3626e19df80/4ee7f/03-pipeline-for-merge-commit-jobs.png 486w\"\n        sizes=\"(max-width: 486px) 100vw, 486px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You should then have a tag pipeline run that looks something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; margin: 0.7rem 0; margin-left: 0!important; margin-right: 0!important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a565b9bff886956fe77cef2a5eb5cab4/27b8e/04-tag-pipeline-run.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAABzElEQVR42p1U2XabMBTkMxobs28CscksAaf1Ofn/f5poLk7TJLT18cMwiGV05y5yytqgrgyKTEOXHXLLqmjQ1Gesyy9Ze16C4Aaf7GcIg304QV7ALTKkSmMaV0zTCy7rFeOw4mye0TYD+mZEM60w11es44K+zOCdNvGvcKq6x2A/ptg8XUTkbGYksfq9a2TBdZqWiMIccZjaKPfh9O2Iy3LFMv8UnsYLhvMiL91jiJMbbThGcA8fa+8U3+x/EeRDXfUSWZL3iCKFOMpR5Nqi/oxiY+aVzGi/CdISX7Y20lqfRbzWRriyRfrznkyUqpXncVR8i9JJQhtRo3HSmbUVWivRh82/gHbJu5Yl4VmDMO0QJBsnSbn78T1w4jAXy6poodQGWsrS6jFBJpaNXOveNrOR3LCpKfqQIMVMP0vl8qwS9r1Uok4fsH4TnCQiTgWjI3MTVvahCDvbMrrqpKnZj7MdP4LCe+P1LzhsgdIWxLWT8PTDw+HJl5ZgpGyh4yH4NBn/FQyCFO0wy2HQdxNUblsnymCmBfP4AmPnmg5Y9XtEHd9PoOpOrLLC/NG3m1StkRQwl5wOHg73CdqLDL6dEtp+/4lr2n0/IO61/AZ9K+j40Mz2UwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Tag pipeline run\"\n        title=\"\"\n        src=\"/static/a565b9bff886956fe77cef2a5eb5cab4/5a190/04-tag-pipeline-run.png\"\n        srcset=\"/static/a565b9bff886956fe77cef2a5eb5cab4/772e8/04-tag-pipeline-run.png 200w,\n/static/a565b9bff886956fe77cef2a5eb5cab4/e17e5/04-tag-pipeline-run.png 400w,\n/static/a565b9bff886956fe77cef2a5eb5cab4/5a190/04-tag-pipeline-run.png 800w,\n/static/a565b9bff886956fe77cef2a5eb5cab4/27b8e/04-tag-pipeline-run.png 836w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The snapshot job will generate and populate the <code class=\"language-text\">Releases</code> under the <code class=\"language-text\">Deployments</code> section of the GitLab sidebar navigation pane which will look something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 637px; margin: 0.7rem 0; margin-left: 0!important; margin-right: 0!important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9134e0a7168d7184e0274083b2cc4735/13a9a/05-gitlab-release.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACBUlEQVR42p1U7XKbMBD0A8UGhCQEEggMNsbYGDt23Gn7/q+xPYlxmzSTSciPneNDWt3trW4RhAq8GMB0j4hlCFccYSBmIaA9MVM+LpgokWx/QVbP4LIApx88TmfBkakk98+LcBUjjqR/kVzRz8QvmAu332foUub5AdKOyLI1Ym4IejbxP0LKUBQHcOPQQ9izPyCOs+8RBkvmm8KLkyfk5kikI3i68VLMJmShQFYNUPaI1PZIywHCk9HCKJlKj6byGcXX8Gv+J8x0hWH8gd1uwHB6wW5PJZOOzGkpnJ6511UIjZQ6qRLjO+qi4Nl7wog2CN2CJyVi1fjnNO8gTefLntBA6xJN3aEqt6jrHdbVlg4opkxfE+amwmW8YhyuOFPs2gNMZqGkBgvlpCMhIoQkT0TfHniQvS05LYjwhpfbT9zvv9HvRyyfmF/sTfuJod93ma7eE8uRmQbbTUfocejPMKQt+06XOQlvbId2d0K77UmjjdcpVcWbkr5MmFMm18ud9Lt5ktUypgsvPyeLPyBcLTmKvEa9brGhLrZUsst00+yhdEOdryck1eQC6rgbINGSf2BsykSpEiqtCI9okREEWSkha6TuO2WfKOujgz7SBSAnPKaT86SbC4uIrOAyCUSFUDqsEQlLJBYBJ0JpYIsazg2a7OSalZs1msszzU/1d346Gzl3/AHAAjJRn+zj1QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GitLab Release\"\n        title=\"\"\n        src=\"/static/9134e0a7168d7184e0274083b2cc4735/13a9a/05-gitlab-release.png\"\n        srcset=\"/static/9134e0a7168d7184e0274083b2cc4735/772e8/05-gitlab-release.png 200w,\n/static/9134e0a7168d7184e0274083b2cc4735/e17e5/05-gitlab-release.png 400w,\n/static/9134e0a7168d7184e0274083b2cc4735/13a9a/05-gitlab-release.png 637w\"\n        sizes=\"(max-width: 637px) 100vw, 637px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p> You're all done!</p>\n<p>I know that there are many ways of doing release management/version management but hopefully this gives some insight on how you can automate the entire process in a CI/CD pipeline and skip all the manual work.</p>\n<p>This has been running very successfully in a few of my projects, and it's been thoroughly tested! But as usual... YMMV.</p>\n<blockquote>\n<p>Disclaimer: This post was written when I was employed at GitLab. The content written above was done in my individual capacity.</p>\n</blockquote>","excerpt":"Versioning and releasing an application can be a time-consuming and complex process, especially when it involves tasks like determining the correct version to bump, adding appropriate tags, syncing the version back to different branches, and more","timeToRead":10,"frontmatter":{"date":"05 April, 2023","updatedAt":null,"slug":"automated-versioning-release-node-gitlab-pipelines","title":"Automated Versioning and Releases with NodeJS in GitLab Pipelines","tags":["gitlab","node","dev ops","ci cd","automation","versioning","release management"],"featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA1ElEQVR42mNwPfUMG3rqevq526X3buffuJ58ikPNMwYsoiefup17DWTYLdrhuOmU24W3xGt+6nrmhfPB2+YlzTYd88yLW21nrAXpx2Y/AxZrL761W7bPumuO2fatZqvXWJW0uxy6AzSRWGc7X3xve/6V5rolJpuPGNROdDzxxO30c6Jsdj7/2nfxroSGSem9SxOT89Ij4oNW7nc699oNw+VYbHY5/dxz/62A7RcCt58L2XstZMcFz73XXIh1NlA/MMzOvnI+98rpzEuns69czrzEqgwAd4Au9UxYofMAAAAASUVORK5CYII="},"backgroundColor":"transparent","images":{"fallback":{"src":"/static/3e3b2cdf3c08dfc2ec76015c7788dbce/6fc77/automated-versioning-release-node-gitlab-pipelines.png","srcSet":"/static/3e3b2cdf3c08dfc2ec76015c7788dbce/85ced/automated-versioning-release-node-gitlab-pipelines.png 800w,\n/static/3e3b2cdf3c08dfc2ec76015c7788dbce/7c498/automated-versioning-release-node-gitlab-pipelines.png 1080w,\n/static/3e3b2cdf3c08dfc2ec76015c7788dbce/6fc77/automated-versioning-release-node-gitlab-pipelines.png 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/3e3b2cdf3c08dfc2ec76015c7788dbce/28281/automated-versioning-release-node-gitlab-pipelines.webp 800w,\n/static/3e3b2cdf3c08dfc2ec76015c7788dbce/0b5d5/automated-versioning-release-node-gitlab-pipelines.webp 1080w,\n/static/3e3b2cdf3c08dfc2ec76015c7788dbce/a020d/automated-versioning-release-node-gitlab-pipelines.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":500}}}}},"comments":{"edges":[]}},"pageContext":{"slug":"automated-versioning-release-node-gitlab-pipelines"}},"staticQueryHashes":["3649515864","983108779"],"slicesMap":{}}
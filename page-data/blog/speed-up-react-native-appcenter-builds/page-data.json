{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/blog/speed-up-react-native-appcenter-builds/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://zanechua.com"}},"posts":{"html":"<p>This is more of a tip to speed up your builds in AppCenter. Have you noticed that your builds are a little slow? The build machines are basically Mac Pro's but we're only getting 3 cores worth of processing power. We can validate this by running the <code class=\"language-text\">system_profiler SPHardwareDataType</code> in a script for our builds and the output should be the following</p>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">terminal</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"92309899751708000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`system_profiler SPHardwareDataType\nHardware:\n\n    Hardware Overview:\n\n      Model Name: Apple device\n      Model Identifier: VMware7,1\n      Processor Speed: 3.33 GHz\n      Number of Processors: 1\n      Total Number of Cores: 3\n      L2 Cache (per Core): 256 KB\n      L3 Cache: 12 MB\n      Memory: 14 GB\n      Boot ROM Version: VMW71.00V.13989454.B64.1906190538\n      Apple ROM Info: [MS_VM_CERT/SHA1/27d66596a61c48dd3dc7216fd715126e33f59ae7]Welcome to the Virtual Machine\n      SMC Version (system): 2.8f0\n      Serial Number (system): VMKvRWaCPfZ+\n      Hardware UUID: 4203018E-580F-C1B5-9525-B745CECA79EB`, `92309899751708000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">system_profiler SPHardwareDataType\nHardware:\n\n    Hardware Overview:\n\n      Model Name: Apple device\n      Model Identifier: VMware7,1\n      Processor Speed: <span class=\"token number\">3.33</span> GHz\n      Number of Processors: <span class=\"token number\">1</span>\n      Total Number of Cores: <span class=\"token number\">3</span>\n      L2 Cache <span class=\"token punctuation\">(</span>per Core<span class=\"token punctuation\">)</span>: <span class=\"token number\">256</span> KB\n      L3 Cache: <span class=\"token number\">12</span> MB\n      Memory: <span class=\"token number\">14</span> GB\n      Boot ROM Version: VMW71.00V.13989454.B64.1906190538\n      Apple ROM Info: <span class=\"token punctuation\">[</span>MS_VM_CERT/SHA1/27d66596a61c48dd3dc7216fd715126e33f59ae7<span class=\"token punctuation\">]</span>Welcome to the Virtual Machine\n      SMC Version <span class=\"token punctuation\">(</span>system<span class=\"token punctuation\">)</span>: <span class=\"token number\">2</span>.8f0\n      Serial Number <span class=\"token punctuation\">(</span>system<span class=\"token punctuation\">)</span>: VMKvRWaCPfZ+\n      Hardware UUID: 4203018E-580F-C1B5-9525-B745CECA79EB</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Did you notice something odd here? We have only 3 measely cores but we have a ton of memory. 14 GB to be exact. That got me thinking about using a ram disk to store <code class=\"language-text\">node_modules</code>, <code class=\"language-text\">Pods</code>, <code class=\"language-text\">.gradle</code>, and other various folders that are used for outputting the build.</p>\n<p>Since AppCenter uses the Mac Pro's for both Android and iOS builds, we can use the same commands to mount a ram disk. I am going to be showing you how to do it for <code class=\"language-text\">node_modules</code> and you can apply the same logic to the rest of the folders that you want to create a ram disk for.</p>\n<p>A ram disk is basically an bunch of allocated space in memory. It's ephemeral and we're only doing it because we don't care if we lose the data after every build.</p>\n<h1 id=\"Solve\" style=\"position:relative;\">Solve<a href=\"#Solve\" aria-label=\"Solve permalink\" class=\"remark-header-anchor after\"><svg id=\"header-anchor-icon\" aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>The following code snippet is placed in my <code class=\"language-text\">appcenter-post-clone.sh</code> script.</p>\n<ol>\n<li>Create a ramdisk without mounting and assign it to the <code class=\"language-text\">NODE_MODULE_RAMDISK</code> variable</li>\n<li>Format the ramdisk as a HFS+ volume with the label <code class=\"language-text\">NodeModules</code></li>\n<li>Make all directories recursively for the provided path</li>\n<li>Mount the ramdisk at the node_modules folder</li>\n</ol>\n<div class=\"gatsby-code-title gatsby-remark-code-title\">appcenter-post-clone.sh</div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"68247339600188360000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"Copied\"\n              data-toaster-duration=\"3000\"\n              onClick=\"copyToClipboard(`NODE_MODULE_RAMDISK=\\$(hdid -nomount ram://4194304) #2GB\nnewfs_hfs -v NodeModules \\$NODE_MODULE_RAMDISK\nmkdir -p \\$APPCENTER_SOURCE_DIRECTORY/node_modules || true\ndiskutil mount -mountPoint \\$APPCENTER_SOURCE_DIRECTORY/node_modules \\$NODE_MODULE_RAMDISK`, `68247339600188360000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                Copy<svg class=\"gatsby-code-button-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token assign-left variable\">NODE_MODULE_RAMDISK</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>hdid <span class=\"token parameter variable\">-nomount</span> ram://4194304<span class=\"token variable\">)</span></span> <span class=\"token comment\">#2GB</span>\nnewfs_hfs <span class=\"token parameter variable\">-v</span> NodeModules <span class=\"token variable\">$NODE_MODULE_RAMDISK</span>\n<span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> <span class=\"token variable\">$APPCENTER_SOURCE_DIRECTORY</span>/node_modules <span class=\"token operator\">||</span> <span class=\"token boolean\">true</span>\ndiskutil <span class=\"token function\">mount</span> <span class=\"token parameter variable\">-mountPoint</span> <span class=\"token variable\">$APPCENTER_SOURCE_DIRECTORY</span>/node_modules <span class=\"token variable\">$NODE_MODULE_RAMDISK</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>You can use the above snippet in combination with my post on <a href=\"/blog/appcenter-caching-vendor-libraries\">AppCenter caching for Vendor libraries</a></p>","excerpt":"This is more of a tip to speed up your builds in AppCenter. Have you noticed that your builds are a little slow? The build machines are basically Mac Pro's but we're only getting 3 cores worth of processing power. We can validate this by running theâ€¦","timeToRead":2,"frontmatter":{"date":"26 July, 2021","updatedAt":null,"slug":"speed-up-react-native-appcenter-builds","title":"Speed Up React Native builds in AppCenter","tags":["appcenter","mobile app","ios","android","react-native","dev ops"],"featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAyklEQVR42mOQfD0PJ3ozX+T7Usm38yVfYVfAgF3bq7mSHxdJPZru2Jchc2OCxMdFIBEiNUu9XSD2Yqbkuka38GT5pfWib+ZIvZ5PhOZXIJ3iV/v421OqZi7af/hIWdcUma2dEp8WYDoei81SbxaI3J+k0F6yb8eBk8cPnz9yWmtGk+g7LJZjd7bEw2mCKyoKZsw7c+hk46LVUocnSn4kzmYQertA8tNC0QMdSotaxQ/2SHxYgDXAGXDG06u5Up8WSnxdJPlxIa6oAgB/FgOcg2DL3wAAAABJRU5ErkJggg=="},"backgroundColor":"transparent","images":{"fallback":{"src":"/static/ec4c7dfd150aea73df17a1358022915d/6fc77/speed-up-react-native-appcenter-builds.png","srcSet":"/static/ec4c7dfd150aea73df17a1358022915d/85ced/speed-up-react-native-appcenter-builds.png 800w,\n/static/ec4c7dfd150aea73df17a1358022915d/7c498/speed-up-react-native-appcenter-builds.png 1080w,\n/static/ec4c7dfd150aea73df17a1358022915d/6fc77/speed-up-react-native-appcenter-builds.png 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/ec4c7dfd150aea73df17a1358022915d/28281/speed-up-react-native-appcenter-builds.webp 800w,\n/static/ec4c7dfd150aea73df17a1358022915d/0b5d5/speed-up-react-native-appcenter-builds.webp 1080w,\n/static/ec4c7dfd150aea73df17a1358022915d/a020d/speed-up-react-native-appcenter-builds.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":500}}}}},"comments":{"edges":[]}},"pageContext":{"slug":"speed-up-react-native-appcenter-builds"}},"staticQueryHashes":["3649515864","983108779"],"slicesMap":{}}